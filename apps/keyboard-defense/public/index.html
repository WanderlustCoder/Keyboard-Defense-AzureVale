<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0e1030" />
    <title>Keyboard Defense</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="manifest" href="manifest.webmanifest" />
  </head>
  <body>
    <div id="parallax-shell" aria-hidden="true" role="presentation">
      <div class="parallax-layer parallax-layer--sky"></div>
      <div class="parallax-layer parallax-layer--glow"></div>
      <div class="parallax-layer parallax-layer--stars"></div>
      <div class="parallax-layer parallax-layer--clouds"></div>
      <div class="parallax-layer parallax-layer--far"></div>
      <div class="parallax-layer parallax-layer--mid"></div>
      <div class="parallax-layer parallax-layer--near"></div>
      <div class="parallax-layer parallax-layer--rain"></div>
    </div>
    <div
      id="loading-screen"
      data-visible="true"
      aria-live="polite"
      aria-busy="true"
      role="status"
    >
      <div class="loading-card">
        <div class="loading-pixel">
          <div class="loading-pixel-sprite" aria-hidden="true"></div>
        </div>
        <div class="loading-copy">
          <p class="loading-title">Forging defenses...</p>
          <p class="loading-status" id="loading-status">Loading pixel defenders...</p>
          <p class="loading-tip-label">Tip</p>
          <p class="loading-tip" id="loading-tip">Keep wrists relaxed and float above home row.</p>
        </div>
      </div>
    </div>
    <div id="app">
      <aside id="wave-rail" class="wave-rail">
        <section class="wave-preview">
          <div class="wave-preview-header">
            <h2>Upcoming Enemies</h2>
            <p class="wave-preview-sub">Scout the wave before it hits.</p>
          </div>
          <div
            id="hint-wave-preview"
            class="contextual-hint"
            data-visible="false"
            role="status"
            aria-live="polite"
          >
            <p class="contextual-hint-text">
              Hint: Preview shows the next wave. Hover an enemy to read its role and tips.
            </p>
            <button type="button" class="contextual-hint-close" aria-label="Dismiss wave preview hint">
              x
            </button>
          </div>
          <div
            id="wave-preview-hint"
            class="wave-preview-hint"
            role="status"
            aria-live="polite"
            aria-hidden="true"
            data-visible="false"
          ></div>
          <div id="wave-preview-list"></div>
          <div
            id="enemy-bio-card"
            class="enemy-bio-card"
            aria-live="polite"
            aria-hidden="true"
            data-visible="false"
          >
            <div class="enemy-bio-header">
              <div>
                <p id="enemy-bio-role" class="enemy-bio-role"></p>
                <h3 id="enemy-bio-title" class="enemy-bio-title"></h3>
              </div>
              <span id="enemy-bio-danger" class="enemy-bio-danger"></span>
            </div>
            <p id="enemy-bio-description" class="enemy-bio-description"></p>
            <div class="enemy-bio-columns">
              <div>
                <p class="enemy-bio-label">Abilities</p>
                <ul id="enemy-bio-abilities"></ul>
              </div>
              <div>
                <p class="enemy-bio-label">Tips</p>
                <ul id="enemy-bio-tips"></ul>
              </div>
            </div>
          </div>
        </section>
      </aside>
      <div id="playfield-shell" class="playfield-shell">
        <div class="playfield-topbar">
          <div class="playfield-brand">
            <h1>Keyboard Defense</h1>
            <div class="playfield-actions">
              <button id="fullscreen-button" type="button" aria-pressed="false" aria-label="Toggle fullscreen">
                Fullscreen
              </button>
              <button id="pause-button" type="button" aria-label="Pause game">Pause</button>
              <button id="roadmap-launch" type="button" aria-label="Open roadmap">Roadmap</button>
              <button
                id="shortcut-launch"
                class="icon-button"
                type="button"
                aria-label="Show keyboard shortcuts"
              >
                <span aria-hidden="true">?</span>
              </button>
            </div>
          </div>
          <div class="playfield-health">
            <span id="castle-health-label">Castle Health</span>
            <div class="bar">
              <div class="fill" id="castle-health-bar"></div>
            </div>
          </div>
          <div class="playfield-meta">
            <div class="session-inline">
              <span class="session-label">Session</span>
              <span id="session-timer" class="session-time session-time--inline">00:00</span>
            </div>
            <div class="session-inline">
              <span class="session-label">Today</span>
              <span
                id="screen-time-today"
                class="session-time session-time--inline"
                data-state="ok"
                aria-label="Screen time today 0 minutes"
              >
                0m
              </span>
            </div>
            <div
              id="latency-indicator"
              class="latency-indicator latency-indicator--inline"
              data-state="good"
              role="status"
              aria-live="polite"
              aria-label="Input latency good"
            >
              <span class="latency-dot" aria-hidden="true"></span>
              <span class="latency-label">Input latency</span>
              <svg
                id="latency-sparkline"
                class="latency-sparkline"
                viewBox="0 0 80 18"
                role="presentation"
                aria-hidden="true"
              >
                <polyline id="latency-sparkline-path" points="0,18 80,18" />
              </svg>
              <span id="latency-value" class="latency-value">0ms</span>
            </div>
          </div>
        </div>
        <div class="playfield-stage">
          <canvas id="game-surface" width="960" height="540"></canvas>
          <div class="playfield-overlay">
            <section
              class="tutorial-banner"
              id="tutorial-banner"
              data-visible="false"
              data-anchor="left"
              aria-live="polite"
              aria-hidden="true"
              tabindex="-1"
            >
              <div class="tutorial-banner__header">
                <button
                  type="button"
                  class="tutorial-banner__progress"
                  data-role="tutorial-progress"
                  hidden
                ></button>
                <button
                  type="button"
                  class="tutorial-banner__close"
                  data-role="tutorial-close"
                  aria-label="Dismiss tutorial hint"
                >
                  ✕
                </button>
              </div>
              <div class="tutorial-banner__content" data-role="tutorial-message"></div>
              <div class="tutorial-banner__meta">
                <div class="tutorial-banner__keycaps" aria-hidden="true">
                  <span class="tutorial-banner__key-label">Continue</span>
                  <span class="tutorial-banner__keycap">Enter</span>
                </div>
                <button
                  type="button"
                  class="tutorial-banner__skip"
                  data-role="tutorial-skip"
                >
                  Skip tutorial
                </button>
                <button
                  type="button"
                  class="tutorial-banner__toggle"
                  data-role="tutorial-toggle"
                  aria-expanded="false"
                >
                  Show full tip
                </button>
              </div>
            </section>
            <section
              class="tutorial-dock"
              id="tutorial-dock"
              data-collapsed="true"
              hidden
              aria-label="Tutorial dock"
            >
              <button
                type="button"
                class="tutorial-dock__toggle"
                id="tutorial-dock-toggle"
                data-role="tutorial-dock-toggle"
                aria-expanded="false"
              >
                Tutorial dock
                <span
                  class="tutorial-dock__summary"
                  id="tutorial-dock-summary"
                  data-role="tutorial-dock-summary"
                ></span>
              </button>
              <ol class="tutorial-dock__steps" id="tutorial-dock-steps" data-role="tutorial-dock-steps"></ol>
            </section>
          </div>
        </div>
        <div class="playfield-footer">
          <div class="playfield-footer-left">
            <div class="playfield-gold">
              <span class="playfield-gold-label">Gold</span>
              <span id="resource-gold">0</span>
              <span id="resource-delta"></span>
            </div>
            <div class="typing-drills-cta" id="typing-drills-cta">
              <div class="typing-drills-cta-text">
                <p class="typing-drills-cta-title">Ready for a lesson?</p>
                <p class="typing-drills-cta-copy">
                  Follow the curriculum to build accuracy before the next wave.
                </p>
                <p class="typing-drills-cta-hint">Shortcut: Shift + R to launch recommended drill</p>
                <p id="typing-drills-cta-reco" class="typing-drills-cta-reco" data-visible="false">
                  Recommended: <span class="typing-drills-cta-reco-mode"></span>
                </p>
              </div>
              <button id="typing-drills-open" class="typing-drills-cta-button" type="button">
                Open lessons
              </button>
            </div>
          </div>
          <div
            id="break-reminder"
            class="break-reminder break-reminder--inline"
            data-visible="false"
            role="status"
            aria-live="polite"
            aria-hidden="true"
          >
            <div class="break-reminder-copy">
              <p class="break-reminder-title">Time for a stretch?</p>
              <p class="break-reminder-tip" id="break-reminder-tip">
                You have been practicing for 20 minutes. Stand, stretch, and sip water.
              </p>
            </div>
            <div class="break-reminder-actions">
              <button
                id="break-reminder-snooze"
                type="button"
                aria-label="Snooze break reminder for 10 minutes"
              >
                Remind in 10m
              </button>
              <button
                id="break-reminder-reset"
                type="button"
                aria-label="Confirm break taken and reset timer"
              >
                I took a break
              </button>
            </div>
          </div>
          <div
            id="posture-reminder"
            class="break-reminder break-reminder--inline posture-reminder"
            data-visible="false"
            role="status"
            aria-live="polite"
            aria-hidden="true"
          >
            <div class="break-reminder-copy">
              <p class="break-reminder-title">Posture check</p>
              <p class="break-reminder-tip" id="posture-reminder-tip">
                Reset shoulders, wrists, and screen height before the next wave.
              </p>
            </div>
            <div class="break-reminder-actions">
              <button
                id="posture-reminder-dismiss"
                type="button"
                aria-label="Dismiss posture reminder"
              >
                Got it
              </button>
            </div>
          </div>
        </div>
      </div>
      <aside id="hud">
        <section class="castle">
        </section>
        <section class="hud-dock" id="hud-dock">
          <div class="hud-dock-tabs" id="hud-dock-tabs" role="tablist" aria-label="HUD command dock">
            <button
              id="hud-dock-tab-build"
              type="button"
              class="hud-dock-tab"
              data-pane-target="build"
              role="tab"
              aria-selected="true"
              aria-controls="hud-pane-build"
            >
              Build
              <span class="hud-dock-sub">Towers &amp; upgrades</span>
            </button>
            <button
              id="hud-dock-tab-quests"
              type="button"
              class="hud-dock-tab"
              data-pane-target="quests"
              role="tab"
              aria-selected="false"
              aria-controls="hud-pane-quests"
            >
              Quests
              <span class="hud-dock-sub">Missions &amp; side tasks</span>
            </button>
            <button
              id="hud-dock-tab-rewards"
              type="button"
              class="hud-dock-tab"
              data-pane-target="rewards"
              role="tab"
              aria-selected="false"
              aria-controls="hud-pane-rewards"
            >
              Rewards
              <span class="hud-dock-sub">Medals &amp; certificates</span>
            </button>
            <button
              id="hud-dock-tab-lore"
              type="button"
              class="hud-dock-tab"
              data-pane-target="lore"
              role="tab"
              aria-selected="false"
              aria-controls="hud-pane-lore"
            >
              Lore
              <span class="hud-dock-sub">Scrolls &amp; museum</span>
            </button>
          </div>
          <div class="hud-pane-stack" id="hud-pane-stack">
            <div
              class="hud-pane"
              id="hud-pane-build"
              data-pane="build"
              role="tabpanel"
              aria-labelledby="hud-dock-tab-build"
            >
              <div class="hud-pane-label">
                <p class="hud-pane-title">Build &amp; Commands</p>
                <p class="hud-pane-copy">Pop the drawer to place towers or repair the keep.</p>
              </div>
              <div class="build-drawer" id="build-drawer" data-open="false">
                <div class="build-rail">
                  <div class="build-rail-copy">
                    <p class="build-rail-kicker">Build &amp; Commands</p>
                    <p class="build-rail-title">Deploy towers, upgrade the keep</p>
                  </div>
                  <button
                    id="build-drawer-toggle"
                    type="button"
                    class="build-rail-button"
                    aria-expanded="false"
                    aria-controls="build-content"
                  >
                    Open build menu
                  </button>
                </div>
                <div class="build-content" id="build-content" aria-hidden="true" hidden>
                  <div class="upgrades" id="upgrade-panel"></div>
                </div>
              </div>
            </div>
            <div
              class="hud-pane"
              id="hud-pane-quests"
              data-pane="quests"
              role="tabpanel"
              aria-labelledby="hud-dock-tab-quests"
              aria-hidden="true"
              hidden
            >
              <div class="hud-pane-label">
                <p class="hud-pane-title">Mission Control</p>
                <p class="hud-pane-copy">Track quests without scrolling below the battlefield.</p>
              </div>
              <section class="quest-panel" id="side-quest-panel" aria-live="polite">
                <div class="quest-panel__content">
                  <div>
                    <p class="quest-panel__kicker">Side quests</p>
                    <p class="quest-panel__summary" id="side-quest-summary">
                      Complete optional goals between lessons.
                    </p>
                    <p class="quest-panel__stats" id="side-quest-stats">0 active ú 0 completed</p>
                  </div>
                  <button id="side-quest-open" type="button" class="secondary">Open Quest Log</button>
                </div>
              </section>
              <section
                class="quest-panel"
                id="daily-quest-panel"
                aria-live="polite"
                aria-label="Daily quest board"
              >
                <div class="session-goals-panel__content">
                  <div>
                    <p class="daily-quest-panel__kicker">Daily quests</p>
                    <p class="daily-quest-panel__summary" id="daily-quest-summary">
                      New quests arrive every day.
                    </p>
                    <ul class="session-goals-panel__list" id="daily-quest-list"></ul>
                  </div>
                </div>
              </section>
              <section
                class="quest-panel"
                id="weekly-quest-panel"
                aria-live="polite"
                aria-label="Weekly mastery quest"
              >
                <div class="session-goals-panel__content">
                  <div>
                    <p class="weekly-quest-panel__kicker">Weekly mastery quest</p>
                    <p class="weekly-quest-panel__summary" id="weekly-quest-summary">
                      Weekly quests culminate in a Trial wave.
                    </p>
                    <ul class="session-goals-panel__list" id="weekly-quest-list"></ul>
                  </div>
                  <button
                    id="weekly-quest-trial-start"
                    type="button"
                    class="secondary"
                    data-visible="false"
                  >
                    Start Weekly Trial
                  </button>
                </div>
              </section>
              <section
                class="quest-panel session-goals-panel"
                id="session-goals-panel"
                aria-live="polite"
                aria-label="Session goals"
              >
                <div class="session-goals-panel__content">
                  <div>
                    <p class="session-goals-panel__kicker">Session goals</p>
                    <p class="session-goals-panel__summary" id="session-goals-summary">
                      Adaptive targets tune after each run.
                    </p>
                    <ul class="session-goals-panel__list" id="session-goals-list"></ul>
                  </div>
                </div>
              </section>
            </div>
            <div
              class="hud-pane"
              id="hud-pane-rewards"
              data-pane="rewards"
              role="tabpanel"
              aria-labelledby="hud-dock-tab-rewards"
              aria-hidden="true"
              hidden
            >
              <div class="hud-pane-label">
                <p class="hud-pane-title">Rewards</p>
                <p class="hud-pane-copy">Season track, medals, and printable certificates.</p>
              </div>
              <section class="season-track-panel" id="season-track-panel" aria-live="polite">
                <div class="season-track-panel__content">
                  <div>
                    <p class="season-track-panel__kicker">Season 4</p>
                    <p class="season-track-panel__summary" id="season-track-summary">
                      Earn predictable rewards by completing lessons.
                    </p>
                    <p class="season-track-panel__stats">
                      <span id="season-track-progress-pill">0 / 10 unlocked</span>
                      <span aria-hidden="true" class="season-track-panel__dot">Ł</span>
                      <span id="season-track-lessons">0 lessons completed</span>
                    </p>
                    <p class="season-track-panel__next" id="season-track-next">
                      Next reward after 1 more lesson.
                    </p>
                    <p class="season-track-panel__requirement" id="season-track-next-requirement"></p>
                  </div>
                  <button id="season-track-open" type="button" class="secondary">View Track</button>
                </div>
              </section>
              <section class="lesson-medals" id="lesson-medal-panel" aria-live="polite">
                <div class="lesson-medal__content">
                  <div class="lesson-medal__badge" id="lesson-medal-badge" data-tier="bronze">Bronze</div>
                  <div class="lesson-medal__copy">
                    <p class="lesson-medal__kicker">Lesson medals</p>
                    <p class="lesson-medal__summary" id="lesson-medal-summary">
                      Complete a typing drill to start earning medals.
                    </p>
                    <p class="lesson-medal__path" id="lesson-medal-path">
                      Next lesson: Lesson 1 - Home Row Foundations (0/6 complete)
                    </p>
                    <p class="lesson-medal__best" id="lesson-medal-best">
                      Burst: None ú Endurance: None ú Precision: None
                    </p>
                    <p class="lesson-medal__next" id="lesson-medal-next">
                      Replay drills to chase the next tier.
                    </p>
                  </div>
                  <button id="lesson-medal-open" type="button" class="secondary">View Medals</button>
                </div>
              </section>
              <section class="wpm-ladder" id="wpm-ladder-panel" aria-live="polite">
                <div class="wpm-ladder__content">
                  <div>
                    <p class="wpm-ladder__kicker">Personal bests</p>
                    <p class="wpm-ladder__summary" id="wpm-ladder-summary">
                      Complete a typing drill to start your WPM ladder.
                    </p>
                    <p class="wpm-ladder__stats" id="wpm-ladder-stats">
                      Burst: None · Endurance: None · Precision: None
                    </p>
                    <p class="wpm-ladder__top" id="wpm-ladder-top">No runs recorded yet.</p>
                  </div>
                  <button id="wpm-ladder-open" type="button" class="secondary">View Ladder</button>
                </div>
              </section>
              <section class="biome-gallery" id="biome-gallery-panel" aria-live="polite">
                <div class="biome-gallery__content">
                  <div>
                    <p class="biome-gallery__kicker">Biome gallery</p>
                    <p class="biome-gallery__summary" id="biome-gallery-summary">
                      Pick a backdrop to theme your drills.
                    </p>
                    <p class="biome-gallery__stats" id="biome-gallery-stats">
                      No biome sessions yet.
                    </p>
                  </div>
                  <button id="biome-gallery-open" type="button" class="secondary">Open Gallery</button>
                </div>
              </section>
              <section class="training-calendar" id="training-calendar-panel" aria-live="polite">
                <div class="training-calendar__content">
                  <div>
                    <p class="training-calendar__kicker">Training calendar</p>
                    <p class="training-calendar__summary" id="training-calendar-summary">
                      Complete a drill to start the calendar.
                    </p>
                    <p class="training-calendar__stats" id="training-calendar-stats">
                      0 lessons · 0 drills last 4 weeks
                    </p>
                  </div>
                  <button id="training-calendar-open" type="button" class="secondary">View Calendar</button>
                </div>
              </section>
              <section class="streak-token" id="streak-token-panel" aria-live="polite">
                <div>
                  <p class="streak-token__kicker">Streak freeze</p>
                  <p class="streak-token__summary" id="streak-token-count">0 tokens available</p>
                  <p class="streak-token__status" id="streak-token-status">
                    No active streak yet. Complete a drill to start one.
                  </p>
                </div>
              </section>
              <section class="mastery-certificate" id="mastery-certificate-panel" aria-live="polite">
                <div class="mastery-cert__content">
                  <div class="mastery-cert__copy">
                    <p class="mastery-cert__kicker">Print-ready</p>
                    <p class="mastery-cert__summary" id="mastery-certificate-summary">
                      Complete a session to generate a mastery certificate.
                    </p>
                    <p class="mastery-cert__stats" id="mastery-certificate-stats">
                      0 lessons  0% accuracy  0 WPM
                    </p>
                    <p class="mastery-cert__date" id="mastery-certificate-date"></p>
                    <label class="mastery-cert__name">
                      <span>Certificate name</span>
                      <input
                        id="mastery-certificate-name"
                        type="text"
                        placeholder="Enter learner name"
                      />
                    </label>
                  </div>
                  <button id="mastery-certificate-open" type="button" class="secondary">
                    Open Certificate
                  </button>
                </div>
              </section>
            </div>
            <div
              class="hud-pane"
              id="hud-pane-lore"
              data-pane="lore"
              role="tabpanel"
              aria-labelledby="hud-dock-tab-lore"
              aria-hidden="true"
              hidden
            >
              <div class="hud-pane-label">
                <p class="hud-pane-title">Lore &amp; Gallery</p>
                <p class="hud-pane-copy">Dip into scrolls or stroll the museum without leaving the fight.</p>
              </div>
              <section class="lore-scrolls" id="lore-scroll-panel" aria-live="polite">
                <div class="lore-scrolls__content">
                  <div class="lore-scrolls__copy">
                    <p class="lore-scrolls__kicker">Reading break</p>
                    <p class="lore-scrolls__summary" id="lore-scrolls-summary">
                      Finish lessons to unlock calm lore scrolls between waves.
                    </p>
                    <p class="lore-scrolls__stats">
                      <span id="lore-scrolls-progress">0 / 5 scrolls</span>
                      <span aria-hidden="true" class="lore-scrolls__dot">ú</span>
                      <span id="lore-scrolls-lessons">0 lessons completed</span>
                    </p>
                    <p class="lore-scrolls__next" id="lore-scrolls-next">
                      Next scroll unlocks after 1 more lesson.
                    </p>
                  </div>
                  <button id="lore-scrolls-open" type="button" class="secondary">Open Scrolls</button>
                </div>
              </section>
              <section class="museum-panel" id="castle-museum-panel" aria-live="polite">
                <div class="museum-panel__content">
                  <div>
                    <p class="museum-panel__kicker">Castle Museum</p>
                    <p class="museum-panel__summary" id="castle-museum-summary">
                      Unlock art, skins, and artifacts as you progress.
                    </p>
                    <p class="museum-panel__stats" id="castle-museum-stats">0 / 0 on display</p>
                  </div>
                  <button id="castle-museum-open" type="button" class="secondary">Open Museum</button>
                </div>
              </section>
            </div>
          </div>
        </section>
        <section class="companion" id="companion">
          <div
            class="companion-visual"
            id="companion-pet"
            data-mood="calm"
            role="img"
            aria-live="polite"
            aria-label="Companion mood: Calm"
          >
            <div class="companion-pet-core">
              <div class="companion-pet-face">
                <span class="companion-pet-eye companion-pet-eye--left"></span>
                <span class="companion-pet-eye companion-pet-eye--right"></span>
                <span class="companion-pet-mouth"></span>
              </div>
              <div class="companion-pet-tail"></div>
              <div class="companion-pet-spark companion-pet-spark--one"></div>
              <div class="companion-pet-spark companion-pet-spark--two"></div>
            </div>
          </div>
          <div class="companion-meta">
            <p class="companion-title">Companion</p>
            <p class="companion-mood" id="companion-mood-label">Calm</p>
            <p class="companion-tip" id="companion-tip">
              Keep clean streaks to cheer them up.
            </p>
            <div class="mentor-dialogue" id="mentor-dialogue" data-focus="neutral" aria-live="polite">
              <div class="mentor-dialogue__header">
                <span class="mentor-dialogue__label">Mentor</span>
                <span id="mentor-dialogue-focus" class="mentor-dialogue__pill">Balanced</span>
              </div>
              <p id="mentor-dialogue-text" class="mentor-dialogue__text">
                Balanced focus: keep accuracy steady, then push speed.
              </p>
            </div>
          </div>
        </section>
        <section class="typing">
          <div id="active-word"></div>
          <div id="typing-metrics" aria-live="polite">
            <div class="typing-metric">
              <span class="typing-metric-label">Accuracy</span>
              <span class="typing-metric-value" id="typing-accuracy">100%</span>
            </div>
            <div class="typing-metric">
              <span class="typing-metric-label">WPM</span>
              <span class="typing-metric-value" id="typing-wpm">0</span>
            </div>
          </div>
          <div id="combo-stats">Combo x0</div>
          <div id="combo-accuracy-delta" role="status" aria-live="polite"></div>
          <input
            id="typing-input"
            autocomplete="off"
            autofocus
            placeholder="Type to attack..."
            aria-label="Typing input. Type the on-screen words to attack."
          />
          <div id="finger-hint" class="finger-hint" data-visible="false" role="status" aria-live="polite"></div>
          <div
            id="caps-lock-warning"
            class="caps-lock-warning"
            data-visible="false"
            role="status"
            aria-live="polite"
            aria-hidden="true"
          >
            Caps Lock is on - accuracy may drop.
          </div>
          <div id="lock-indicators" class="lock-indicators" aria-live="polite" role="status">
            <span id="lock-indicator-caps" class="lock-indicator" data-active="false">Caps</span>
            <span id="lock-indicator-num" class="lock-indicator" data-active="false">Num</span>
          </div>
          <div
            id="virtual-keyboard"
            class="virtual-keyboard"
            data-visible="false"
            aria-hidden="true"
            aria-label="On-screen keyboard"
          ></div>
          <div
            id="hint-typing-drills"
            class="contextual-hint"
            data-visible="false"
            role="status"
            aria-live="polite"
          >
            <p class="contextual-hint-text">
              Hint: Use Shift + R to open drills before the next wave for a quick warmup.
            </p>
            <button type="button" class="contextual-hint-close" aria-label="Dismiss drills hint">
              ×
            </button>
          </div>
        </section>
        
        <section
          id="roadmap-glance"
          class="roadmap-glance"
          data-visible="false"
          aria-live="polite"
          aria-hidden="true"
        >
          <div class="roadmap-glance-header">
            <h2>Season Roadmap</h2>
            <div class="roadmap-glance-actions">
              <button id="roadmap-glance-open" type="button" class="ghost-button">
                Open
              </button>
              <button id="roadmap-glance-clear" type="button" class="ghost-button">
                Clear
              </button>
            </div>
          </div>
          <p id="roadmap-glance-title" class="roadmap-glance-title"></p>
          <p id="roadmap-glance-progress" class="roadmap-glance-progress"></p>
        </section>
        <section class="events">
          <h2>Battle Log</h2>
          <div
            id="hint-battle-log"
            class="contextual-hint"
            data-visible="false"
            role="status"
            aria-live="polite"
          >
            <p class="contextual-hint-text">
              Hint: The battle log tracks pickups, breaches, and shields. Toggle it in Options.
            </p>
            <button type="button" class="contextual-hint-close" aria-label="Dismiss battle log hint">
              ×
            </button>
          </div>
          <div class="battle-log-controls">
            <div id="battle-log-summary" class="battle-log-summary" role="group" aria-label="Battle log summary">
              <button type="button" class="battle-log-summary-item" data-category="breach" aria-pressed="false">
                <span class="battle-log-summary-label">Breaches</span>
                <span class="battle-log-summary-count" id="battle-log-count-breach">0</span>
                <span class="battle-log-summary-last" id="battle-log-last-breach">No breaches yet.</span>
              </button>
              <button type="button" class="battle-log-summary-item" data-category="perfect" aria-pressed="false">
                <span class="battle-log-summary-label">Perfects</span>
                <span class="battle-log-summary-count" id="battle-log-count-perfect">0</span>
                <span class="battle-log-summary-last" id="battle-log-last-perfect">No perfect words yet.</span>
              </button>
              <button type="button" class="battle-log-summary-item" data-category="medal" aria-pressed="false">
                <span class="battle-log-summary-label">Medals</span>
                <span class="battle-log-summary-count" id="battle-log-count-medal">0</span>
                <span class="battle-log-summary-last" id="battle-log-last-medal">No medals earned yet.</span>
              </button>
              <button type="button" class="battle-log-summary-item" data-category="quest" aria-pressed="false">
                <span class="battle-log-summary-label">Quests</span>
                <span class="battle-log-summary-count" id="battle-log-count-quest">0</span>
                <span class="battle-log-summary-last" id="battle-log-last-quest">No quest updates yet.</span>
              </button>
              <button type="button" class="battle-log-summary-item" data-category="upgrade" aria-pressed="false">
                <span class="battle-log-summary-label">Upgrades</span>
                <span class="battle-log-summary-count" id="battle-log-count-upgrade">0</span>
                <span class="battle-log-summary-last" id="battle-log-last-upgrade">No upgrades yet.</span>
              </button>
            </div>
            <div id="battle-log-filters" class="battle-log-filters" role="group" aria-label="Battle log filters">
              <button type="button" class="battle-log-filter" data-category="breach">
                <span class="battle-log-keycap">B</span>
                Breaches
              </button>
              <button type="button" class="battle-log-filter" data-category="perfect">
                <span class="battle-log-keycap">P</span>
                Perfects
              </button>
              <button type="button" class="battle-log-filter" data-category="medal">
                <span class="battle-log-keycap">M</span>
                Medals
              </button>
              <button type="button" class="battle-log-filter" data-category="quest">
                <span class="battle-log-keycap">Q</span>
                Quests
              </button>
              <button type="button" class="battle-log-filter" data-category="upgrade">
                <span class="battle-log-keycap">U</span>
                Upgrades
              </button>
              <button type="button" class="battle-log-filter battle-log-filter--clear" data-action="clear">
                Clear
              </button>
            </div>
          </div>
          <ul id="battle-log"></ul>
        </section>
        <section class="debug">
          <details>
            <summary>Debug Hooks</summary>
            <button id="debug-pause">Pause</button>
            <button id="debug-resume">Resume</button>
            <button id="debug-step">Step Frame</button>
            <button id="debug-gold">+100 Gold</button>
            <button id="debug-crystal-toggle" type="button">Enable Crystal Pulse</button>
            <button id="debug-elite-toggle" type="button">Enable Elite Affixes</button>
            <button id="debug-turret-downgrade" type="button" aria-pressed="false">
              Enable Turret Downgrade
            </button>
            <button id="debug-spawn-dummy" type="button">Spawn Practice Dummy</button>
            <button id="debug-clear-dummies" type="button">Clear Practice Dummies</button>
            <div class="debug-wave-preview-row">
              <div class="debug-wave-preview-inputs">
                <label for="debug-wave-preview-url">Wave Preview URL</label>
                <input
                  id="debug-wave-preview-url"
                  type="url"
                  inputmode="url"
                  placeholder="http://localhost:4179/"
                  aria-label="Wave preview URL"
                />
                <button id="debug-wave-preview-save" type="button">Save URL</button>
              </div>
              <button id="debug-wave-preview" type="button">Open Wave Preview</button>
            </div>
            <button id="debug-diagnostics">Toggle Diagnostics</button>
            <button id="debug-sound">Toggle Sound</button>
            <div class="debug-sound-controls">
              <label class="debug-sound-controls-label" for="debug-sound-volume"
                >Sound volume</label
              >
              <input
                id="debug-sound-volume"
                class="debug-sound-controls-slider"
                type="range"
                min="0"
                max="1"
                step="0.01"
                value="0.8"
                aria-valuemin="0"
                aria-valuemax="1"
              />
              <span
                id="debug-sound-volume-value"
                class="debug-sound-controls-value"
                data-state="enabled"
                aria-live="polite"
              >
                80%
              </span>
              <label class="debug-sound-controls-label" for="debug-sound-intensity"
                >Audio intensity</label
              >
              <input
                id="debug-sound-intensity"
                class="debug-sound-controls-slider"
                type="range"
                min="0.5"
                max="1.5"
                step="0.01"
                value="1"
                aria-valuemin="0.5"
                aria-valuemax="1.5"
              />
              <span
                id="debug-sound-intensity-value"
                class="debug-sound-controls-value"
                data-state="enabled"
                aria-live="polite"
              >
                100%
              </span>
            </div>
            <button id="debug-analytics-reset">Reset Analytics</button>
            <button id="debug-analytics-viewer-toggle" type="button" aria-expanded="false">
              Show Analytics Viewer
            </button>
            <div
              id="debug-telemetry-controls"
              class="debug-telemetry-controls"
              aria-hidden="true"
              data-visible="false"
            >
              <p class="debug-telemetry-title">Telemetry</p>
              <div class="debug-telemetry-buttons">
                <button id="debug-telemetry-toggle" type="button" aria-pressed="false">
                  Enable Telemetry
                </button>
                <button id="debug-telemetry-flush" type="button">Flush Telemetry (0)</button>
                <button id="debug-telemetry-download" type="button">Download Telemetry (0)</button>
              </div>
              <label class="debug-telemetry-endpoint" for="debug-telemetry-endpoint">
                Endpoint
                <div class="debug-telemetry-endpoint-row">
                  <input
                    id="debug-telemetry-endpoint"
                    type="url"
                    inputmode="url"
                    placeholder="https://collector.example/ingest"
                    autocomplete="off"
                  />
                  <button id="debug-telemetry-endpoint-apply" type="button">Apply</button>
                </div>
              </label>
            </div>
            <button id="debug-tutorial-replay">Replay Tutorial</button>
            <div
              id="debug-analytics-viewer"
              data-visible="false"
              aria-hidden="true"
              aria-live="polite"
              role="region"
              aria-label="Recent wave analytics summaries"
            >
              <div class="analytics-viewer-topbar">
                <div class="analytics-tablist" role="tablist" aria-label="Analytics views">
                  <button
                    id="debug-analytics-tab-summary"
                    class="analytics-tab"
                    type="button"
                    role="tab"
                    aria-selected="true"
                    data-tab="summary"
                  >
                    Summary
                  </button>
                  <button
                    id="debug-analytics-tab-traces"
                    class="analytics-tab"
                    type="button"
                    role="tab"
                    aria-selected="false"
                    data-tab="traces"
                  >
                    Traces
                  </button>
                  <button
                    id="debug-analytics-tab-exports"
                    class="analytics-tab"
                    type="button"
                    role="tab"
                    aria-selected="false"
                    data-tab="exports"
                  >
                    Exports
                  </button>
                </div>
                <div class="analytics-mini-bar">
                  <button id="debug-analytics-copy-link" type="button" class="ghost">
                    Copy recap
                  </button>
                  <button id="debug-analytics-export" type="button" class="secondary">
                    Download Analytics
                  </button>
                </div>
              </div>
              <div
                id="debug-analytics-panel-summary"
                class="analytics-viewer-panel"
                data-tab="summary"
                data-active="true"
                role="tabpanel"
                aria-labelledby="debug-analytics-tab-summary"
              >
                <div class="analytics-viewer-controls">
                  <label for="debug-analytics-viewer-filter">Show</label>
                  <select id="debug-analytics-viewer-filter">
                    <option value="all">All waves</option>
                    <option value="last-5">Last 5</option>
                    <option value="last-10">Last 10</option>
                    <option value="breaches">Breaches</option>
                    <option value="shielded">Shield breaks</option>
                  </select>
                </div>
                <div id="debug-analytics-drills" class="analytics-drills" aria-live="polite"></div>
                <div class="analytics-table-wrapper">
                  <table aria-describedby="debug-analytics-viewer-caption">
                    <caption id="debug-analytics-viewer-caption">
                      Recent wave summaries
                    </caption>
                    <thead>
                      <tr>
                        <th scope="col">Wave</th>
                        <th scope="col">Mode</th>
                        <th scope="col">Accuracy</th>
                        <th scope="col">Breaches</th>
                        <th scope="col">Defeated</th>
                        <th scope="col">Perfect Words</th>
                        <th scope="col">Avg Reaction</th>
                        <th scope="col">DPS</th>
                        <th scope="col">Turret DPS</th>
                        <th scope="col">Typing DPS</th>
                        <th scope="col">Turret dmg</th>
                        <th scope="col">Typing dmg</th>
                        <th scope="col">Shield Breaks</th>
                        <th scope="col">Repairs</th>
                        <th scope="col">HP Restored</th>
                        <th scope="col">Repair Gold</th>
                        <th scope="col">Gold</th>
                        <th scope="col">Bonus</th>
                        <th scope="col">Castle Bonus</th>
                        <th scope="col">Duration</th>
                      </tr>
                    </thead>
                    <tbody id="debug-analytics-viewer-body">
                      <tr class="analytics-empty-row">
                        <td colspan="20">
                          No wave summaries yet - finish a wave to populate analytics.
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div
                id="debug-analytics-panel-traces"
                class="analytics-viewer-panel"
                data-tab="traces"
                role="tabpanel"
                aria-labelledby="debug-analytics-tab-traces"
                aria-hidden="true"
              >
                <div id="debug-analytics-traces" class="analytics-traces" aria-live="polite">
                  <p class="analytics-traces__empty">
                    No traces yet. Finish a wave to view castle alerts and gold events.
                  </p>
                </div>
              </div>
              <div
                id="debug-analytics-panel-exports"
                class="analytics-viewer-panel"
                data-tab="exports"
                role="tabpanel"
                aria-labelledby="debug-analytics-tab-exports"
                aria-hidden="true"
              >
                <div class="analytics-exports">
                  <p class="analytics-exports__summary">
                    Export bundles wave summaries, drills, telemetry, and HUD preferences into a single
                    siege-ready JSON.
                  </p>
                  <div class="analytics-exports__meta" id="debug-analytics-export-meta">
                    <div class="analytics-exports__pill">
                      <span class="label">Waves</span>
                      <span class="value" id="debug-analytics-export-waves">0</span>
                    </div>
                    <div class="analytics-exports__pill">
                      <span class="label">Drills</span>
                      <span class="value" id="debug-analytics-export-drills">0</span>
                    </div>
                    <div class="analytics-exports__pill">
                      <span class="label">Breaches</span>
                      <span class="value" id="debug-analytics-export-breaches">0</span>
                    </div>
                    <div class="analytics-exports__pill">
                      <span class="label">Time to first turret</span>
                      <span class="value" id="debug-analytics-export-ttf">—</span>
                    </div>
                  </div>
                  <p class="analytics-exports__note" id="debug-analytics-export-note">
                    Stay steady: export after a full run for the richest story.
                  </p>
                </div>
              </div>
            </div>
          </details>
        </section>
      </aside>
    </div>
    <div id="diagnostics-overlay" data-visible="false"></div>
    <div
      id="main-menu-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="main-menu-title"
    >
      <div class="main-menu-card">
        <h1 id="main-menu-title">Keyboard Defense</h1>
        <p id="main-menu-copy">Prepare for the Siege of the Azure Vale.</p>
        <div class="main-menu-options" id="main-menu-options">
          <label class="option-toggle main-menu-telemetry" id="main-menu-telemetry-toggle-wrapper">
            <input id="main-menu-telemetry-toggle" type="checkbox" />
            <span class="option-toggle-label">Send telemetry to help improve the siege.</span>
            <span class="option-toggle-help">
              Telemetry stays local unless you export it. Toggle anytime from the pause menu.
            </span>
          </label>
          <label class="option-toggle" id="main-menu-crystal-toggle-wrapper">
            <input id="main-menu-crystal-toggle" type="checkbox" />
            <span class="option-toggle-label">Enable Crystal Pulse turret (experimental)</span>
            <span class="option-toggle-help">
              Unlocks shield-burst pulses that shred enemy barriers when you need them.
            </span>
          </label>
          <label class="option-toggle" id="main-menu-elite-toggle-wrapper">
            <input id="main-menu-elite-toggle" type="checkbox" />
            <span class="option-toggle-label">Enable Elite Affixes</span>
            <span class="option-toggle-help">
              Allow armored, shielded, or aura elites to appear for greater rewards.
            </span>
          </label>
          <label class="option-toggle option-select" id="main-menu-practice-lane-focus-wrapper">
            <span class="option-toggle-label">Practice Lane Focus</span>
            <select id="main-menu-practice-lane-focus" aria-label="Practice lane focus">
              <option value="all">All lanes</option>
              <option value="0">Lane A only</option>
              <option value="1">Lane B only</option>
              <option value="2">Lane C only</option>
            </select>
            <span class="option-toggle-help">
              Practice mode only: limits spawns, hazards, and bonus events to a single lane for calmer
              targeted runs.
            </span>
          </label>
          <details class="option-details" id="main-menu-challenge-modifiers">
            <summary class="option-details-summary">
              <span>Challenge modifiers</span>
              <span class="option-details-pill" id="main-menu-challenge-multiplier">Score x1.00</span>
            </summary>
            <div class="option-details-body">
              <label class="option-toggle" id="main-menu-challenge-enabled-wrapper">
                <input id="main-menu-challenge-enabled" type="checkbox" />
                <span class="option-toggle-label">Enable challenge modifiers (Practice/Trial)</span>
                <span class="option-toggle-help">
                  Opt-in difficulty tweaks with a clear score multiplier.
                </span>
              </label>
              <div class="option-details-grid" id="main-menu-challenge-grid" data-disabled="true">
                <label class="option-toggle" id="main-menu-challenge-fog-wrapper">
                  <input id="main-menu-challenge-fog" type="checkbox" />
                  <span class="option-toggle-label">Fog of War (Score x1.15)</span>
                  <span class="option-toggle-help">Hide upcoming spawns and add lane fog.</span>
                </label>
                <label class="option-toggle" id="main-menu-challenge-fast-spawns-wrapper">
                  <input id="main-menu-challenge-fast-spawns" type="checkbox" />
                  <span class="option-toggle-label">Fast spawns (Score x1.25)</span>
                  <span class="option-toggle-help">Shorter, more intense waves.</span>
                </label>
                <label class="option-toggle" id="main-menu-challenge-limited-mistakes-wrapper">
                  <input id="main-menu-challenge-limited-mistakes" type="checkbox" />
                  <span class="option-toggle-label">Limited mistakes (Score x1.20)</span>
                  <span class="option-toggle-help">Hit the mistake limit and the wave ends.</span>
                </label>
                <label
                  class="option-toggle option-select"
                  id="main-menu-challenge-mistake-budget-wrapper"
                >
                  <span class="option-toggle-label">Mistake limit (per wave)</span>
                  <select
                    id="main-menu-challenge-mistake-budget"
                    aria-label="Mistake limit per wave"
                  >
                    <option value="5">5 mistakes</option>
                    <option value="8">8 mistakes</option>
                    <option value="10">10 mistakes</option>
                    <option value="12">12 mistakes</option>
                    <option value="15">15 mistakes</option>
                  </select>
                  <span class="option-toggle-help">Used only when Limited mistakes is enabled.</span>
                </label>
              </div>
              <p class="option-details-help" id="main-menu-challenge-summary">
                No challenge modifiers active.
              </p>
            </div>
          </details>
        </div>
        <div class="main-menu-actions">
          <button id="main-menu-start-tutorial">Begin Tutorial</button>
          <button id="main-menu-skip-tutorial">Skip Tutorial</button>
          <button id="main-menu-practice-mode">Practice Mode</button>
          <button id="main-menu-typing-drills">Typing Drills</button>
          <p id="main-menu-typing-drill-reco" class="main-menu-typing-drill-reco" data-visible="false">
            Recommended: <span class="main-menu-typing-drill-reco-mode"></span>
          </p>
          <button id="main-menu-typing-drill-run" type="button" class="secondary">
            Run Recommended Drill
          </button>
          <button id="main-menu-typing-warmup" type="button" class="secondary">
            Start 5-Min Warm-up
          </button>
          <button id="main-menu-replay-tutorial">Replay Tutorial</button>
        </div>
      </div>
    </div>
    <div
      id="tutorial-summary"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="tutorial-summary-title"
    >
      <div class="tutorial-summary-card">
        <h2 id="tutorial-summary-title">Training Complete</h2>
        <p id="tutorial-summary-copy">Great work defending the gate. Here's how you did:</p>
        <ul id="tutorial-summary-stats">
          <li data-field="accuracy"></li>
          <li data-field="combo"></li>
          <li data-field="breaches"></li>
          <li data-field="shield-breaks"></li>
          \n
          <li data-field="gold"></li>
        </ul>
        <div class="tutorial-summary-actions">
          <button id="tutorial-summary-continue">Proceed to Campaign</button>
          <button id="tutorial-summary-replay">Replay Tutorial</button>
        </div>
      </div>
    </div>
    <div
      id="tutorial-dock-modal"
      class="tutorial-dock-modal"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="tutorial-dock-modal-title"
      aria-describedby="tutorial-dock-modal-copy"
    >
      <div class="tutorial-dock-modal__card">
        <h3 id="tutorial-dock-modal-title">Replay tutorial step?</h3>
        <p id="tutorial-dock-modal-copy"></p>
        <div class="tutorial-dock-modal__actions">
          <button id="tutorial-dock-modal-confirm" type="button">Replay step</button>
          <button id="tutorial-dock-modal-cancel" type="button" class="secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>
    <div
      id="wave-scorecard"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="wave-scorecard-title"
        >
          <div class="wave-scorecard-card">
            <header class="wave-scorecard-header">
              <h2 id="wave-scorecard-title">Wave Complete</h2>
              <p id="wave-scorecard-subtitle">
                Breathe easy-your defenses held. Here's the after-action report.
              </p>
            </header>
            <ul id="wave-scorecard-stats">
              <li data-field="wave"></li>
          <li data-field="accuracy"></li>
          <li data-field="combo"></li>
          <li data-field="session-combo"></li>
          <li data-field="defeated"></li>
          <li data-field="breaches"></li>
          <li data-field="perfect-words"></li>
          <li data-field="reaction"></li>
          <li data-field="dps"></li>
          <li data-field="dps-turret"></li>
          <li data-field="dps-typing"></li>
          <li data-field="damage-turret"></li>
          <li data-field="damage-typing"></li>
          <li data-field="shield-breaks"></li>
          <li data-field="repairs"></li>
          <li data-field="repair-health"></li>
          <li data-field="repair-gold"></li>
          <li data-field="bonus-gold"></li>
              <li data-field="castle-bonus"></li>
              <li data-field="gold"></li>
            </ul>
            <div
              id="wave-scorecard-coach"
              class="wave-scorecard-coach"
              data-visible="false"
              aria-labelledby="wave-scorecard-coach-title"
              aria-hidden="true"
            >
              <h3 id="wave-scorecard-coach-title">Coach Summary</h3>
              <ul id="wave-scorecard-coach-list" class="wave-scorecard-coach-list">
                <li data-field="win"></li>
                <li data-field="gap"></li>
                <li data-field="drill"></li>
              </ul>
            </div>
            <p
              id="wave-scorecard-tip"
              class="wave-scorecard-tip"
              data-visible="false"
              role="status"
              aria-live="polite"
              aria-hidden="true"
            ></p>
            <div class="wave-scorecard-actions">
              <button
                id="wave-scorecard-drill"
                type="button"
                class="secondary"
                data-visible="false"
                aria-hidden="true"
              >
                Run Suggested Drill
              </button>
              <button id="wave-scorecard-continue" type="button" class="primary">
                Ready the Next Wave
              </button>
            </div>
      </div>
    </div>
    <div
      id="enemy-intro-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="enemy-intro-title"
      aria-hidden="true"
    >
      <div class="enemy-intro-card">
        <header class="enemy-intro-header">
          <div class="enemy-intro-kicker">First encounter</div>
          <h3 id="enemy-intro-title">New enemy</h3>
          <p id="enemy-intro-role" class="enemy-intro-role"></p>
          <button
            id="enemy-intro-close"
            class="icon-button"
            type="button"
            aria-label="Close enemy intro"
          ></button>
        </header>
        <p id="enemy-intro-description" class="enemy-intro-description"></p>
        <ul id="enemy-intro-tips" class="enemy-intro-tips"></ul>
        <div class="enemy-intro-actions">
          <button id="enemy-intro-dismiss" type="button" class="primary-button">
            Got it
          </button>
        </div>
      </div>
    </div>
    <div
      id="accessibility-onboarding"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="accessibility-onboarding-title"
      aria-describedby="accessibility-onboarding-desc"
      aria-hidden="true"
    >
      <div class="accessibility-card">
        <header class="accessibility-header">
          <div>
            <p class="accessibility-kicker">Comfort setup</p>
            <h3 id="accessibility-onboarding-title">Pick your comfort defaults</h3>
            <p id="accessibility-onboarding-desc" class="accessibility-desc">
              We can reduce effects and adjust text to keep runs comfortable.
            </p>
          </div>
          <button
            id="accessibility-onboarding-close"
            class="icon-button"
            type="button"
            aria-label="Close accessibility setup"
          ></button>
        </header>
        <div class="accessibility-options">
          <label class="option-toggle">
            <input id="accessibility-reduced-motion" type="checkbox" />
            <span class="option-toggle-label">Reduced Motion</span>
            <span class="option-toggle-help">
              Disable heavy defeat effects and UI transitions.
            </span>
          </label>
          <label class="option-toggle">
            <input id="accessibility-dyslexia-spacing" type="checkbox" />
            <span class="option-toggle-label">Dyslexia Spacing</span>
            <span class="option-toggle-help">
              Adds letter spacing/line height to words and prompts.
            </span>
          </label>
          <label class="option-toggle">
            <input id="accessibility-colorblind" type="checkbox" />
            <span class="option-toggle-label">Colorblind Palette</span>
            <span class="option-toggle-help">
              Swaps UI accents for higher separation.
            </span>
          </label>
          <label class="option-toggle">
            <input id="accessibility-virtual-keyboard" type="checkbox" />
            <span class="option-toggle-label">On-screen Keyboard</span>
            <span class="option-toggle-help">
              Shows an on-screen keyboard that highlights the next key while typing.
            </span>
          </label>
          <label class="option-toggle option-select">
            <span class="option-toggle-label">Keyboard Layout</span>
            <select id="accessibility-virtual-keyboard-layout" aria-label="Keyboard layout">
              <option value="qwerty">QWERTY</option>
              <option value="qwertz">QWERTZ</option>
              <option value="azerty">AZERTY</option>
            </select>
            <span class="option-toggle-help">
              Match the on-screen keyboard to your physical layout.
            </span>
          </label>
          <label class="option-toggle option-range">
            <span class="option-toggle-label">Background Brightness</span>
            <input
              id="accessibility-bg-brightness"
              type="range"
              min="0.9"
              max="1.1"
              step="0.01"
              value="1"
              aria-label="Background brightness"
            />
            <span class="option-range-value" id="accessibility-bg-brightness-value">100%</span>
          </label>
        </div>
        <div class="accessibility-presets">
          <div class="accessibility-preset">
            <div class="accessibility-preset-header">
              <span class="accessibility-pill">Recommended</span>
              <p class="accessibility-preset-title">Dyslexia-friendly preset</p>
            </div>
            <p class="accessibility-preset-desc">
              Turns on the dyslexia-friendly font and wider spacing across menus, prompts, and the HUD.
              You can tweak these later in Options.
            </p>
            <button
              id="accessibility-dyslexia-preset"
              type="button"
              class="ghost-button accessibility-preset-button"
            >
              Apply dyslexia preset
            </button>
          </div>
        </div>
        <div class="accessibility-actions">
          <button id="accessibility-skip" type="button" class="ghost-button">Skip</button>
          <button id="accessibility-apply" type="button" class="primary-button">
            Apply &amp; play
          </button>
        </div>
      </div>
    </div>
    <div
      id="roadmap-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="roadmap-overlay-title"
    >
      <div class="roadmap-card">
        <header class="roadmap-header">
          <div class="roadmap-title-block">
            <p class="roadmap-kicker">Siege of the Azure Vale</p>
            <h2 id="roadmap-overlay-title">Season Roadmap</h2>
          </div>
          <button
            id="roadmap-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close season roadmap"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <p class="roadmap-subtitle">
          Track the story beats, systems, and codex drops as you push through the siege.
        </p>
        <div class="roadmap-summary">
          <div class="roadmap-pill" aria-live="polite">
            <span class="roadmap-pill-label">Wave</span>
            <span id="roadmap-summary-wave" class="roadmap-pill-value">Wave 1 / 3</span>
          </div>
          <div class="roadmap-pill" aria-live="polite">
            <span class="roadmap-pill-label">Castle</span>
            <span id="roadmap-summary-castle" class="roadmap-pill-value">Lv. 1</span>
          </div>
          <div class="roadmap-pill" aria-live="polite">
            <span class="roadmap-pill-label">Codex</span>
            <span id="roadmap-summary-lore" class="roadmap-pill-value">0 entries</span>
          </div>
        </div>
        <div class="roadmap-filters" role="group" aria-label="Filter roadmap steps">
          <label><input id="roadmap-filter-story" type="checkbox" checked />Story</label>
          <label><input id="roadmap-filter-systems" type="checkbox" checked />Systems</label>
          <label><input id="roadmap-filter-challenge" type="checkbox" checked />Challenges</label>
          <label><input id="roadmap-filter-lore" type="checkbox" checked />Lore</label>
          <label><input id="roadmap-filter-completed" type="checkbox" />Show completed</label>
        </div>
        <div id="roadmap-tracked" class="roadmap-tracked" data-visible="false">
          <div class="roadmap-tracked-text">
            <p class="roadmap-tracked-label">Tracking</p>
            <p id="roadmap-tracked-title" class="roadmap-tracked-title"></p>
            <p id="roadmap-tracked-progress" class="roadmap-tracked-progress"></p>
          </div>
          <div class="roadmap-tracked-actions">
            <button id="roadmap-tracked-clear" type="button" class="ghost-button">
              Clear
            </button>
          </div>
        </div>
        <ul id="roadmap-list" class="roadmap-list" aria-live="polite"></ul>
      </div>
    </div>
    <div
      id="shortcut-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="shortcut-overlay-title"
    >
      <div class="shortcut-overlay-card">
        <header class="shortcut-overlay-header">
          <h2 id="shortcut-overlay-title">Keyboard Shortcuts</h2>
          <button
            id="shortcut-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close shortcut reference"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <p class="shortcut-overlay-subtitle">Stay on top of the siege with quick commands.</p>
        <ul class="shortcut-list">
          <li>
            <span class="shortcut-key">?</span
            ><span class="shortcut-desc">Toggle this overlay</span>
          </li>
          <li>
            <span class="shortcut-key">D</span
            ><span class="shortcut-desc">Toggle diagnostics overlay</span>
          </li>
          <li>
            <span class="shortcut-key">M</span
            ><span class="shortcut-desc">Mute or enable battle audio</span>
          </li>
          <li>
            <span class="shortcut-key">P</span
            ><span class="shortcut-desc">Pause or resume the battle</span>
          </li>
          <li>
            <span class="shortcut-key">Shift + R</span
            ><span class="shortcut-desc">Open typing drills and auto-run the recommended mode</span>
          </li>
          <li>
            <span class="shortcut-key">Ctrl/Cmd&nbsp;+&nbsp;?</span
            ><span class="shortcut-desc">Clear typing buffer (lose 1 combo)</span>
          </li>
          <li>
            <span class="shortcut-key">Esc</span
            ><span class="shortcut-desc">Dismiss overlays and return focus to typing</span>
          </li>
        </ul>
      </div>
    </div>
    <div
      id="options-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="options-overlay-title"
    >
      <div class="options-overlay-card">
        <header class="options-overlay-header">
          <h2 id="options-overlay-title">Battle Paused</h2>
          <button
            id="options-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close pause menu"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <p class="options-overlay-subtitle">
          Adjust your defenses, then charge back into the fray.
        </p>
        <div class="options-layout">
          <div class="options-nav-slot">
            <nav id="options-quick-nav" class="options-quick-nav" aria-label="Quick menu navigation">
              <button type="button" data-target="overview" aria-current="true">Overview</button>
              <button type="button" data-target="audio">Audio &amp; VFX</button>
              <button type="button" data-target="accessibility">Accessibility</button>
              <button type="button" data-target="hud">HUD &amp; Layout</button>
              <button type="button" data-target="overlays">Overlays</button>
              <button type="button" data-target="diagnostics">Diagnostics</button>
            </nav>
          </div>
          <div class="options-main-column">
            <div class="options-panels" id="options-panels">
              <section
                class="options-panel"
                data-panel="overview"
                data-active="true"
                aria-hidden="false"
              >
                <div class="options-window-grid">
                  <div class="options-window">
                    <div class="options-window-header">
                      <p class="options-window-kicker">Castle Status</p>
                      <h3 class="options-window-title">Overview</h3>
                    </div>
                    <div class="options-window-body">
                      <div
                        id="options-castle-bonus"
                        class="options-info"
                        role="status"
                        aria-live="polite"
                        aria-atomic="true"
                      ></div>
                      <ul
                        id="options-castle-benefits"
                        class="options-benefits"
                        aria-live="polite"
                      ></ul>
                      <div
                        id="options-passives-section"
                        class="options-passives-wrapper"
                        data-collapsed="false"
                      >
                        <div class="options-anchor" id="options-anchor-passives"></div>
                        <div class="options-passives-header">
                          <p class="options-passives-heading">Active Passives</p>
                          <span id="options-passives-summary" class="options-passives-summary"></span>
                          <button
                            id="options-passives-toggle"
                            class="options-passives-toggle"
                            type="button"
                            aria-controls="options-castle-passives"
                            aria-expanded="true"
                          >
                            Hide Active Passives
                          </button>
                        </div>
                        <div class="options-passives-body">
                          <ul
                            id="options-castle-passives"
                            class="options-passives"
                            aria-live="polite"
                          ></ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
              <section class="options-panel" data-panel="audio" aria-hidden="true" hidden>
                <div class="options-window-grid">
                  <div class="options-window">
                    <div class="options-window-header">
                      <p class="options-window-kicker">Audio</p>
                      <h3 class="options-window-title">Sound &amp; VFX</h3>
                    </div>
                    <div class="options-window-body">
                      <section class="options-section" data-group="audio" data-collapsed="false">
                        <div class="options-section-header">
                          <div class="options-anchor" id="options-anchor-audio"></div>
                          <h3>Audio &amp; VFX</h3>
                          <button
                            type="button"
                            class="options-section-toggle"
                            aria-controls="options-section-body-audio"
                            aria-expanded="true"
                          >
                            Collapse
                          </button>
                        </div>
                        <div
                          class="options-toggle-group options-section-body"
                          id="options-section-body-audio"
                        >
                          <label class="option-toggle">
                            <input id="options-sound-toggle" type="checkbox" />
                            <span class="option-toggle-label">Sound Effects</span>
                          </label>
                          <label class="option-toggle option-range">
                            <span class="option-toggle-label">Sound Volume</span>
                            <input
                              id="options-sound-volume"
                              type="range"
                              min="0"
                              max="1"
                              step="0.05"
                              value="0.8"
                              aria-label="Sound volume"
                            />
                            <span class="option-range-value" id="options-sound-volume-value">80%</span>
                          </label>
                          <label class="option-toggle option-range">
                            <span class="option-toggle-label">Audio Intensity</span>
                            <input
                              id="options-sound-intensity"
                              type="range"
                              min="0.5"
                              max="1.5"
                              step="0.05"
                              value="1"
                              aria-label="Audio intensity"
                            />
                            <span class="option-range-value" id="options-sound-intensity-value">100%</span>
                          </label>
                          <label class="option-toggle">
                            <input id="options-music-toggle" type="checkbox" />
                            <span class="option-toggle-label">Dynamic Music</span>
                            <span class="option-toggle-help">
                              Layered stems react to wave danger and castle health.
                            </span>
                          </label>
                          <label class="option-toggle option-range">
                            <span class="option-toggle-label">Music Level</span>
                            <input
                              id="options-music-level"
                              type="range"
                              min="0"
                              max="1"
                              step="0.05"
                              value="0.65"
                              aria-label="Music level"
                            />
                            <span class="option-range-value" id="options-music-level-value">65%</span>
                          </label>
                          <div class="options-audio-library">
                            <button id="options-music-library" type="button" class="secondary">
                              Music Suite
                            </button>
                            <p id="options-music-library-label" class="options-hint">
                              Active suite: Siege Suite (Cinematic)
                            </p>
                          </div>
                          <div class="options-audio-library">
                            <button id="options-ui-sound-library" type="button" class="secondary">
                              UI Sounds
                            </button>
                            <button
                              id="options-ui-sound-preview"
                              type="button"
                              class="ghost"
                              aria-label="Preview current UI sound set"
                            >
                              Preview UI sounds
                            </button>
                            <p id="options-ui-sound-library-label" class="options-hint">
                              UI sounds: Clarity (Clean)
                            </p>
                          </div>
                          <div class="options-audio-library">
                            <button id="options-sfx-library" type="button" class="secondary">
                              SFX Library
                            </button>
                            <p id="options-sfx-library-label" class="options-hint">
                              Active mix: Classic Mix (Balanced)
                            </p>
                          </div>
                          <div class="option-toggle option-range option-shake">
                            <div class="option-shake-header">
                              <label class="option-toggle-label" for="options-screen-shake-toggle">
                                Screen Shake
                              </label>
                              <div class="option-shake-inline">
                                <input id="options-screen-shake-toggle" type="checkbox" />
                                <span class="option-range-value" id="options-screen-shake-intensity-value"
                                  >65%</span
                                >
                              </div>
                            </div>
                            <input
                              id="options-screen-shake-intensity"
                              type="range"
                              min="0"
                              max="1.2"
                              step="0.05"
                              value="0.65"
                              aria-label="Screen shake intensity"
                            />
                            <div class="option-shake-preview">
                              <div
                                class="option-shake-demo"
                                id="options-screen-shake-demo"
                                aria-hidden="true"
                              >
                                <span class="option-shake-demo-box"></span>
                              </div>
                              <button id="options-screen-shake-preview" type="button" class="ghost">
                                Preview shake
                              </button>
                              <span class="option-toggle-help">
                                Play a quick shake before enabling to check comfort. Disabled when Reduced
                                Motion is on.
                              </span>
                            </div>
                          </div>
                        </div>
                      </section>
                    </div>
                  </div>
                </div>
              </section>
              <section class="options-panel" data-panel="accessibility" aria-hidden="true" hidden>
                <div class="options-window-grid">
                  <div class="options-window">
                    <div class="options-window-header">
                      <p class="options-window-kicker">Comfort</p>
                      <h3 class="options-window-title">Accessibility</h3>
                    </div>
                    <div class="options-window-body">
                      <section class="options-section" data-group="accessibility" data-collapsed="false">
                        <div class="options-section-header">
                          <div class="options-anchor" id="options-anchor-accessibility"></div>
                          <h3>Accessibility &amp; Comfort</h3>
                          <button
                            type="button"
                            class="options-section-toggle"
                            aria-controls="options-section-body-accessibility"
                            aria-expanded="true"
                          >
                            Collapse
                          </button>
                        </div>
                        <div
                          class="options-toggle-group options-section-body"
                          id="options-section-body-accessibility"
                        >
                          <label class="option-toggle">
                            <input id="options-low-graphics-toggle" type="checkbox" />
                            <span class="option-toggle-label">Low Graphics Mode</span>
                            <span class="option-toggle-help">
                              Turns off starfield and heavy effects for slower devices (auto-enables reduced motion).
                            </span>
                          </label>
                          <label class="option-toggle">
                            <input id="options-reduced-motion-toggle" type="checkbox" />
                            <span class="option-toggle-label">Reduced Motion</span>
                            <span class="option-toggle-help">
                              Disables enemy defeat splashes and UI transitions; keeps essential cues only.
                            </span>
                          </label>
                          <label class="option-toggle">
                            <input id="options-virtual-keyboard-toggle" type="checkbox" />
                            <span class="option-toggle-label">On-screen Keyboard</span>
                            <span class="option-toggle-help">
                              Shows an on-screen keyboard that highlights the next key while typing.
                            </span>
                          </label>
                          <label class="option-toggle option-select">
                            <span class="option-toggle-label">Keyboard Layout</span>
                            <select id="options-virtual-keyboard-layout" aria-label="Keyboard layout">
                              <option value="qwerty">QWERTY</option>
                              <option value="qwertz">QWERTZ</option>
                              <option value="azerty">AZERTY</option>
                            </select>
                            <span class="option-toggle-help">
                              Match the on-screen keyboard to your physical layout.
                            </span>
                          </label>
                          <label class="option-toggle">
                            <input id="options-haptics-toggle" type="checkbox" />
                            <span class="option-toggle-label">Haptics (vibration)</span>
                            <span class="option-toggle-help">
                              Short vibrations on hits when supported; desktop browsers usually ignore this.
                            </span>
                          </label>
                          <button
                            id="options-contrast-audit"
                            type="button"
                            class="option-toggle option-contrast"
                          >
                            <div class="option-contrast-copy">
                              <span class="option-toggle-label">Contrast Audit Overlay</span>
                              <span class="option-toggle-help">
                                Highlights UI regions that may fail contrast checks. Best-effort preview for quick
                                comfort scans.
                              </span>
                            </div>
                            <span class="option-contrast-cta">Run audit</span>
                          </button>
                          <div
                            class="option-toggle option-selftest"
                            id="options-self-test"
                            role="group"
                            aria-labelledby="options-self-test-title"
                          >
                            <div class="option-selftest-header">
                              <div>
                                <p class="option-selftest-kicker">Accessibility check</p>
                                <p class="option-toggle-label" id="options-self-test-title">Self-Test Cues</p>
                                <p class="option-toggle-help">
                                  Play a quick sound, flash, and motion cue to confirm you can sense them before
                                  enabling effects.
                                </p>
                              </div>
                              <div class="option-selftest-actions">
                                <span class="option-selftest-status" id="options-self-test-status">Not run yet</span>
                                <button id="options-self-test-run" type="button" class="secondary">Run self-test</button>
                              </div>
                            </div>
                            <div class="option-selftest-grid" role="group" aria-label="Self-test confirmations">
                              <label class="option-selftest-row" for="options-self-test-sound">
                                <span
                                  class="option-selftest-indicator"
                                  id="options-self-test-sound-indicator"
                                  aria-hidden="true"
                                ></span>
                                <div class="option-selftest-copy">
                                  <span class="option-selftest-label">Sound chime</span>
                                  <span class="option-toggle-help">Listen for a short chime.</span>
                                </div>
                                <span class="option-selftest-confirm">
                                  <input id="options-self-test-sound" type="checkbox" />
                                  <span class="option-selftest-confirm-label">Heard it</span>
                                </span>
                              </label>
                              <label class="option-selftest-row" for="options-self-test-visual">
                                <span
                                  class="option-selftest-indicator option-selftest-indicator--flash"
                                  id="options-self-test-visual-indicator"
                                  aria-hidden="true"
                                ></span>
                                <div class="option-selftest-copy">
                                  <span class="option-selftest-label">Visual flash</span>
                                  <span class="option-toggle-help">Watch for a bright tile flash.</span>
                                </div>
                                <span class="option-selftest-confirm">
                                  <input id="options-self-test-visual" type="checkbox" />
                                  <span class="option-selftest-confirm-label">Saw it</span>
                                </span>
                              </label>
                              <label class="option-selftest-row" for="options-self-test-motion">
                                <span
                                  class="option-selftest-indicator option-selftest-indicator--motion"
                                  id="options-self-test-motion-indicator"
                                  aria-hidden="true"
                                ></span>
                                <div class="option-selftest-copy">
                                  <span class="option-selftest-label">Motion check</span>
                                  <span class="option-toggle-help">Uses the screen shake preview.</span>
                                </div>
                                <span class="option-selftest-confirm">
                                  <input id="options-self-test-motion" type="checkbox" />
                                  <span class="option-selftest-confirm-label">Felt it</span>
                                </span>
                              </label>
                            </div>
                            <p class="option-toggle-help option-selftest-footnote">
                              Motion step skips when Reduced Motion is on; sound skips when audio is disabled.
                            </p>
                          </div>
                        </div>
                      </section>
                    </div>
                  </div>
                </div>
              </section>
              <section class="options-panel" data-panel="hud" aria-hidden="true" hidden>
                <div class="options-window-grid">
                  <div class="options-window">
                    <div class="options-window-header">
                      <p class="options-window-kicker">Layout</p>
                      <h3 class="options-window-title">HUD &amp; Visuals</h3>
                    </div>
                    <div class="options-window-body">
                      <section class="options-section" data-group="hud" data-collapsed="false">
                        <div class="options-section-header">
                          <div class="options-anchor" id="options-anchor-hud"></div>
                          <h3>HUD &amp; Layout</h3>
                          <button
                            type="button"
                            class="options-section-toggle"
                            aria-controls="options-section-body-hud"
                            aria-expanded="true"
                          >
                            Collapse
                          </button>
                        </div>
                        <div class="options-toggle-group options-section-body" id="options-section-body-hud">
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Text Size</span>
              <select id="options-text-size" aria-label="Text size preference">
                <option value="0.9">Small</option>
                <option value="1">Medium</option>
                <option value="1.1">Large</option>
              </select>
              <span class="option-toggle-help">Scales HUD and menu text without changing layout.</span>
            </label>
            <label class="option-toggle">
              <input id="options-checkered-bg-toggle" type="checkbox" />
              <span class="option-toggle-label">Checkered Background</span>
            </label>
            <label class="option-toggle">
              <input id="options-accessibility-preset" type="checkbox" />
              <span class="option-toggle-label">Accessibility Preset</span>
              <span class="option-toggle-help">
                One-tap bundle for this profile: reduced motion, readable+dyslexia-friendly font,
                larger subtitles, spaced letters, simplified HUD, and audio narration.
              </span>
            </label>
            <label class="option-toggle">
              <input id="options-latency-sparkline" type="checkbox" />
              <span class="option-toggle-label">Show Latency Sparkline</span>
              <span class="option-toggle-help">
                Hide the mini latency graph for reduced-motion or tight layouts; the ms value stays visible.
              </span>
            </label>
            <label class="option-toggle">
              <input id="options-readable-font-toggle" type="checkbox" />
              <span class="option-toggle-label">Readable Font</span>
            </label>
            <label class="option-toggle">
              <input id="options-dyslexia-font-toggle" type="checkbox" />
              <span class="option-toggle-label">Dyslexia-Friendly Font</span>
            </label>
            <label class="option-toggle">
              <input id="options-dyslexia-spacing-toggle" type="checkbox" />
              <span class="option-toggle-label">Increase Letter Spacing</span>
              <span class="option-toggle-help">
                Adds extra spacing and line height for clearer shapes while typing.
              </span>
            </label>
            <label class="option-toggle">
              <input id="options-cognitive-load" type="checkbox" />
              <span class="option-toggle-label">Reduced Cognitive Load</span>
              <span class="option-toggle-help">
                Hides bonus panels (metrics, battle log, roadmap hints) and trims extra overlays for
                younger players. You can re-enable panels anytime.
              </span>
            </label>
            <label class="option-toggle">
              <input id="options-milestone-popups" type="checkbox" checked />
              <span class="option-toggle-label">Milestone Popups</span>
              <span class="option-toggle-help">
                Shows celebration popups for medals, certificates, and other progress beats.
              </span>
            </label>
            <label class="option-toggle">
              <input id="options-audio-narration" type="checkbox" />
              <span class="option-toggle-label">Audio Narration</span>
              <span class="option-toggle-help">
                Adds spoken cues for menus and overlays. Pairs best with headphones.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Voice Pack</span>
              <select id="options-voice-pack" aria-label="Voice pack preference">
                <option value="mentor-classic">Mentor (Classic)</option>
                <option value="mentor-calm">Mentor (Calm)</option>
                <option value="mentor-arcade">Mentor (Arcade)</option>
              </select>
              <span class="option-toggle-help">
                Pick a voice style for narration cues; these packs use text substitutes for now.
              </span>
            </label>
            <label class="option-toggle">
              <input id="options-subtitle-large" type="checkbox" />
              <span class="option-toggle-label">Large-Text Subtitles</span>
              <span class="option-toggle-help">
                Boosts subtitle size and contrast for dialogue, taunts, and overlay captions.
              </span>
            </label>
            <button id="options-subtitle-preview" type="button" class="secondary option-inline-button">
              Subtitle Preview
            </button>
            <label class="option-toggle option-range">
              <span class="option-toggle-label">Tutorial Pacing</span>
              <input
                id="options-tutorial-pacing"
                type="range"
                min="0.75"
                max="1.25"
                step="0.05"
                value="1"
                aria-valuemin="0.75"
                aria-valuemax="1.25"
                aria-valuenow="1"
              />
              <span id="options-tutorial-pacing-value" class="option-range-value">
                100% speed
              </span>
              <span class="option-toggle-help">
                Slow down or speed up tutorial prompts and scripted timings. 100% is default pacing.
              </span>
            </label>
            <label class="option-toggle">
              <input id="options-colorblind-toggle" type="checkbox" />
              <span class="option-toggle-label">Colorblind Palette</span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Colorblind Palette Mode</span>
              <select id="options-colorblind-mode" aria-label="Colorblind palette mode">
                <option value="off">Off</option>
                <option value="deuteran">Deuteran (green weakness)</option>
                <option value="protan">Protan (red weakness)</option>
                <option value="tritan">Tritan (blue weakness)</option>
                <option value="high-contrast">High contrast</option>
              </select>
              <span class="option-toggle-help">
                Pick the palette that separates reds/greens/blues best for you. Enabling a mode turns
                on the palette.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Focus Outline</span>
              <select id="options-focus-outline" aria-label="Focus outline style">
                <option value="system">Match UI colors</option>
                <option value="contrast">High contrast</option>
                <option value="glow">Glow halo</option>
              </select>
              <span class="option-toggle-help">
                Pick a keyboard focus highlight: keep per-panel colors, add a high-contrast ring, or
                use a soft glow halo.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Break Reminders</span>
              <select id="options-break-reminder-interval" aria-label="Break reminder interval">
                <option value="off">Off</option>
                <option value="10">Every 10 minutes</option>
                <option value="20">Every 20 minutes (default)</option>
                <option value="30">Every 30 minutes</option>
                <option value="45">Every 45 minutes</option>
              </select>
              <span class="option-toggle-help">
                Shows a gentle stretch reminder during longer sessions.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Daily Screen-Time Goal</span>
              <select id="options-screen-time-goal" aria-label="Daily screen time goal">
                <option value="off">Off</option>
                <option value="15">15 minutes</option>
                <option value="20">20 minutes</option>
                <option value="30">30 minutes</option>
                <option value="45">45 minutes</option>
                <option value="60">60 minutes</option>
                <option value="90">90 minutes</option>
              </select>
              <span class="option-toggle-help">
                Shows gentle reminders as you reach your goal. Stored only on this device.
                <span id="options-screen-time-status">Today: 0 minutes</span>
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Lockout After Goal</span>
              <select id="options-screen-time-lockout" aria-label="Screen time lockout setting">
                <option value="off">Off</option>
                <option value="rest-15">Rest for 15 minutes</option>
                <option value="rest-30">Rest for 30 minutes</option>
                <option value="rest-60">Rest for 60 minutes</option>
                <option value="today">Lock until tomorrow</option>
              </select>
              <span class="option-toggle-help">
                Optional lockout once the goal is reached (local-only).
              </span>
            </label>
            <button id="options-screen-time-reset" type="button" class="ghost option-inline-button">
              Reset screen time for today
            </button>
            <div class="options-audio-library">
              <button id="options-posture-checklist" type="button" class="secondary">
                Posture Checklist
              </button>
              <p id="options-posture-summary" class="options-hint">
                Quick posture review and 5-minute micro-reminder.
              </p>
            </div>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Castle Skin</span>
              <select id="options-castle-skin" aria-label="Castle skin theme">
                <option value="classic">Classic walls</option>
                <option value="dusk">Dusk citadel</option>
                <option value="aurora">Aurora keep</option>
                <option value="ember">Ember bastion</option>
              </select>
              <span class="option-toggle-help">
                Pick the castle palette you've unlocked from streaks; the HUD updates instantly.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Day/Night Palette</span>
              <select id="options-day-night-theme" aria-label="Day or night palette">
                <option value="night">Night (default)</option>
                <option value="day">Day</option>
              </select>
              <span class="option-toggle-help">
                Swap the global palette to brighter day hues or cooler night tones.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Parallax Background</span>
              <select id="options-parallax-scene" aria-label="Parallax background scene">
                <option value="auto">Auto (match day/night)</option>
                <option value="day">Day drift</option>
                <option value="night">Night drift</option>
                <option value="storm">Stormfront</option>
              </select>
              <span class="option-toggle-help">
                Layered sky + hills with gentle motion; pauses automatically with Reduced Motion or Low Graphics.
              </span>
            </label>
            <label class="option-toggle option-range">
              <span class="option-toggle-label">Background Brightness</span>
              <input
                id="options-bg-brightness"
                type="range"
                min="0.9"
                max="1.1"
                step="0.02"
                value="1"
                aria-label="Background brightness"
              />
              <span class="option-range-value" id="options-bg-brightness-value">100%</span>
              <span class="option-toggle-help">
                Lighten or darken UI backgrounds for comfort; unaffected by low-graphics.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Defeat Animations</span>
              <select id="options-defeat-animation" aria-label="Defeat animation mode">
                <option value="auto">Auto (sprites when available)</option>
                <option value="sprite">Sprites only</option>
                <option value="procedural">Procedural only</option>
              </select>
              <span class="option-toggle-help">
                Choose how enemy defeat bursts render when art assets are available.
              </span>
            </label>
            <label class="option-toggle" id="options-elite-affix-toggle-wrapper">
              <input id="options-elite-affix-toggle" type="checkbox" />
              <span class="option-toggle-label">Enable Elite Affixes</span>
              <span class="option-toggle-help">
                Armored, shielded, or aura elites join waves when enabled; toggle off for calmer runs.
              </span>
            </label>
            <label class="option-toggle" id="options-crystal-toggle-wrapper">
              <input id="options-crystal-toggle" type="checkbox" />
              <span class="option-toggle-label">Enable Crystal Pulse turret</span>
              <span class="option-toggle-help">
                Experimental turret that delivers bonus shield damage for barrier-heavy waves.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">HUD Font Size</span>
              <select id="options-font-scale">
                <option value="0.85">Small</option>
                <option value="1">Default</option>
                <option value="1.15">Large</option>
                <option value="1.3">Extra Large</option>
              </select>
              <span class="option-toggle-help">
                Tip: While this menu is open press [ / ] to change HUD font size.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">HUD Zoom</span>
              <select id="options-hud-zoom" aria-label="HUD zoom">
                <option value="0.8">80% (tiny)</option>
                <option value="0.9">90% (compact)</option>
                <option value="1">100% (default)</option>
                <option value="1.1">110% (comfortable)</option>
                <option value="1.2">120% (large)</option>
              </select>
              <span class="option-toggle-help">
                Scales the entire HUD for small displays or low-vision comfort. Does not affect the game
                canvas.
              </span>
            </label>
            <label class="option-toggle">
              <input id="options-hud-left" type="checkbox" />
              <span class="option-toggle-label">Left-Handed HUD Layout</span>
              <span class="option-toggle-help">
                Flips the HUD to the left side of the screen so the game canvas sits on the right.
              </span>
            </label>
            <button id="options-layout-preview" type="button" class="secondary option-inline-button">
              Preview Layouts
            </button>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Pause Shortcut</span>
              <select id="options-hotkey-pause" aria-label="Pause shortcut key">
                <option value="p">P (default)</option>
                <option value="escape">Escape</option>
                <option value="space">Spacebar</option>
                <option value="o">O</option>
              </select>
              <span class="option-toggle-help">
                Choose which key pauses/resumes. Works even while typing input is focused.
              </span>
            </label>
            <label class="option-toggle option-select">
              <span class="option-toggle-label">Shortcuts Overlay</span>
              <select id="options-hotkey-shortcuts" aria-label="Shortcuts overlay key">
                <option value="?">?</option>
                <option value="slash">/</option>
                <option value="f1">F1</option>
              </select>
              <span class="option-toggle-help">
                Pick a key to toggle the keyboard shortcuts overlay for accessibility.
              </span>
            </label>
                        </div>
                      </section>
                    </div>
                  </div>
                </div>
              </section>
              <section class="options-panel" data-panel="overlays" aria-hidden="true" hidden>
                <div class="options-window-grid">
                  <div class="options-window">
                    <div class="options-window-header">
                      <p class="options-window-kicker">Progress</p>
                      <h3 class="options-window-title">Overlays &amp; Codex</h3>
                    </div>
                    <div class="options-window-body">
                      <section class="options-section" data-group="overlays" data-collapsed="false">
                        <div class="options-section-header">
                          <div class="options-anchor" id="options-anchor-overlays"></div>
                          <h3>Overlays &amp; Progress</h3>
                          <button
                            type="button"
                            class="options-section-toggle"
                            aria-controls="options-section-body-overlays"
                            aria-expanded="true"
                          >
                            Collapse
                          </button>
                        </div>
                        <div class="options-section-body" id="options-section-body-overlays">
                          <div class="options-toggle-group">
                            <label class="option-toggle">
                              <input id="options-toggle-metrics" type="checkbox" />
                              <span class="option-toggle-label">Show Typing Metrics</span>
                              <span class="option-toggle-help">
                                Hides or shows the Accuracy/WPM panel if you prefer fewer HUD elements.
                              </span>
                            </label>
                            <label class="option-toggle">
                              <input id="options-toggle-wave-preview" type="checkbox" />
                              <span class="option-toggle-label">Show Upcoming Enemies</span>
                              <span class="option-toggle-help">
                                Toggle the wave preview list; turn off for a cleaner combat view.
                              </span>
                            </label>
                            <label class="option-toggle">
                              <input id="options-toggle-wave-preview-threat" type="checkbox" />
                              <span class="option-toggle-label">Show Lane Threat Summary</span>
                              <span class="option-toggle-help">
                                Adds damage and priority hints to the lane summary above Upcoming Enemies.
                              </span>
                            </label>
                            <label class="option-toggle">
                              <input id="options-toggle-battle-log" type="checkbox" />
                              <span class="option-toggle-label">Show Battle Log</span>
                              <span class="option-toggle-help">
                                Turn off the running battle log if you only want on-screen cues.
                              </span>
                            </label>
                          </div>
                          <div class="options-actions">
                            <button id="options-parental-info" type="button" class="secondary">
                              Parental Info
                            </button>
                            <button id="options-sticker-book" type="button" class="secondary">
                              Sticker Book
                            </button>
                            <button id="options-season-track" type="button" class="secondary">
                              Season Reward Track
                            </button>
                            <button id="options-readability-guide" type="button" class="secondary">
                              Enemy Readability Guide
                            </button>
                            <button id="options-museum" type="button" class="secondary">
                              Castle Museum
                            </button>
                            <button id="options-side-quests" type="button" class="secondary">
                              Side Quest Log
                            </button>
                            <button id="options-mastery-certificate" type="button" class="secondary">
                              Mastery Certificate
                            </button>
                            <button id="options-lesson-medals" type="button" class="secondary">
                              Lesson Medals
                            </button>
                            <button id="options-wpm-ladder" type="button" class="secondary">
                              WPM Ladder
                            </button>
                            <button id="options-biome-gallery" type="button" class="secondary">
                              Biome Gallery
                            </button>
                            <button id="options-training-calendar" type="button" class="secondary">
                              Training Calendar
                            </button>
                            <button id="options-parent-summary" type="button" class="secondary">
                              Weekly Parent Summary
                            </button>
                            <button id="options-lore-scrolls" type="button" class="secondary">
                              Lore Scrolls
                            </button>
                            <button id="options-typing-drills" type="button" class="secondary">
                              Open Typing Drills
                            </button>
                            <button id="options-end-session" type="button" class="secondary">
                              End Session
                            </button>
                            <p class="options-hint">
                              Tip: Press Shift + R to launch the recommended drill instantly.
                            </p>
                          </div>
                        </div>
                      </section>
                    </div>
                  </div>
                </div>
              </section>
              <section class="options-panel" data-panel="diagnostics" aria-hidden="true" hidden>
                <div class="options-window-grid">
                  <div class="options-window">
                    <div class="options-window-header">
                      <p class="options-window-kicker">Debug</p>
                      <h3 class="options-window-title">Diagnostics</h3>
                    </div>
                    <div class="options-window-body">
                      <section class="options-section" data-group="diagnostics" data-collapsed="false">
                        <div class="options-section-header">
                          <div class="options-anchor" id="options-anchor-diagnostics"></div>
                          <h3>Diagnostics</h3>
                          <button
                            type="button"
                            class="options-section-toggle"
                            aria-controls="options-section-body-diagnostics"
                            aria-expanded="true"
                          >
                            Collapse
                          </button>
                        </div>
                        <div
                          class="options-toggle-group options-section-body"
                          id="options-section-body-diagnostics"
                        >
                          <label class="option-toggle">
                            <input id="options-diagnostics-toggle" type="checkbox" />
                            <span class="option-toggle-label">Diagnostics Overlay</span>
                          </label>
                          <label class="option-toggle" id="options-telemetry-toggle-wrapper">
                            <input id="options-telemetry-toggle" type="checkbox" />
                            <span class="option-toggle-label">Send Telemetry</span>
                          </label>
                          <button
                            id="options-telemetry-queue-download"
                            type="button"
                            class="secondary"
                          >
                            Download Telemetry Queue
                          </button>
                          <button id="options-telemetry-queue-clear" type="button" class="secondary">
                            Clear Telemetry Queue
                          </button>
                          <button id="options-analytics-export" type="button" class="secondary">
                            Download Analytics
                          </button>
                          <button
                            id="options-session-timeline-export"
                            type="button"
                            class="secondary"
                          >
                            Download Session Timeline (CSV)
                          </button>
                          <button
                            id="options-keystroke-timing-export"
                            type="button"
                            class="secondary"
                          >
                            Download Keystroke Timing (CSV)
                          </button>
                          <button id="options-progress-export" type="button" class="secondary">
                            Export Progress
                          </button>
                          <button id="options-progress-import" type="button" class="secondary">
                            Import Progress
                          </button>
                        </div>
                      </section>
                    </div>
                  </div>
                </div>
              </section>
            </div>
            <div class="options-footer">
              <button id="options-resume-button" type="button" class="primary">Resume Battle</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      id="parental-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="parental-overlay-title"
      aria-describedby="parental-overlay-desc"
      aria-hidden="true"
    >
      <div class="info-overlay-card">
        <header class="info-overlay-header">
          <div>
            <p class="info-overlay-kicker">For parents & guardians</p>
            <h2 id="parental-overlay-title">Privacy & Safety Notes</h2>
            <p id="parental-overlay-desc" class="info-overlay-subtitle">
              Keyboard Defense is local-first: no accounts, no ads, and no online tracking by default.
              Everything is built for ages 8-16 on Edge/Chrome.
            </p>
          </div>
          <button
            id="parental-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close parental info"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <ul class="info-overlay-list">
          <li>Progress and settings stay in browser storage (local-only) unless you export them.</li>
          <li>
            Exports are manual downloads (progress, analytics, diagnostics like session timelines and keystroke
            timing).
          </li>
          <li>
            Telemetry is opt-in and off by default; events queue locally and only send if you set an endpoint and
            flush (you can also download or clear the queue in Diagnostics).
          </li>
          <li>Coach prompts like “Why did you stop?” store local notes to help recommend drills.</li>
          <li>No accounts, chat, social features, ads, or payment flows are present.</li>
          <li>You can clear everything anytime via browser storage or by resetting progress.</li>
        </ul>
        <p class="info-overlay-footer">
          Questions about data? Open the pause menu, then Diagnostics, to review and download local-only reports.
        </p>
      </div>
    </div>
    <div
      id="dropoff-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="dropoff-overlay-title"
      aria-describedby="dropoff-overlay-desc"
      aria-hidden="true"
    >
      <div class="info-overlay-card dropoff-overlay-card">
        <header class="info-overlay-header">
          <div>
            <p class="info-overlay-kicker">Coach Mode</p>
            <h2 id="dropoff-overlay-title">Why did you stop?</h2>
            <p id="dropoff-overlay-desc" class="info-overlay-subtitle">
              Pick a reason so we can recommend the next best drill. This stays on your device.
            </p>
          </div>
          <button
            id="dropoff-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close drop-off prompt"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="options-actions dropoff-overlay-actions">
          <button type="button" class="secondary" data-dropoff-reason="done">I'm done for now</button>
          <button type="button" class="secondary" data-dropoff-reason="break">Taking a break</button>
          <button type="button" class="secondary" data-dropoff-reason="tired">I'm tired</button>
          <button type="button" class="secondary" data-dropoff-reason="frustrated">I'm frustrated</button>
          <button type="button" class="secondary" data-dropoff-reason="too-hard">It felt too hard</button>
          <button type="button" class="secondary" data-dropoff-reason="too-easy">It felt too easy</button>
          <button type="button" class="secondary" data-dropoff-reason="keyboard">
            Keyboard problems
          </button>
          <button type="button" class="secondary" data-dropoff-reason="other">Other</button>
        </div>
        <div class="options-actions dropoff-overlay-footer">
          <button id="dropoff-overlay-skip" type="button" class="secondary">Skip</button>
          <button id="dropoff-overlay-cancel" type="button" class="secondary">Cancel</button>
        </div>
      </div>
    </div>
    <div
      id="typing-drills-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="typing-drills-title"
    >
      <div class="typing-drills-card">
        <div class="typing-drills-header">
          <div>
            <p class="typing-drills-kicker">Training Grounds</p>
            <h2 id="typing-drills-title">Typing Drills</h2>
            <p class="typing-drills-subtitle">
              Follow the lesson path to build fundamentals. Use drills to target weak spots without
              risking the gate.
            </p>
            <p
              id="typing-drill-fallback"
              class="typing-drill-fallback"
              data-visible="false"
              role="status"
              aria-live="polite"
            >
              <span class="typing-drill-fallback__pill">No recommendation</span>
              <span class="typing-drill-fallback__text">You're in the groove - pick any drill.</span>
            </p>
            <div id="typing-drill-toast" class="typing-drill-toast" role="status" aria-live="polite"></div>
            <div id="typing-drill-recommendation" class="typing-drill-recommendation" data-visible="false">
              <span id="typing-drill-recommendation-badge" class="typing-drill-recommendation__badge"></span>
              <span id="typing-drill-recommendation-reason" class="typing-drill-recommendation__reason"></span>
              <button
                id="typing-drill-recommendation-run"
                type="button"
                class="typing-drill-recommendation__run"
              >
                Run it
              </button>
            </div>
            <p class="typing-drills-shortcut">Keyboard: Shift + R to open and auto-run the recommended drill.</p>
          </div>
          <button
            id="typing-drills-close"
            class="icon-button typing-drills-close"
            type="button"
            aria-label="Close typing drills"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="typing-drills-body">
          <div class="typing-drills-art" aria-hidden="true">
            <div class="typing-drills-orb"></div>
            <div class="typing-drills-arc typing-drills-arc--outer"></div>
            <div class="typing-drills-arc typing-drills-arc--inner"></div>
            <div class="typing-drills-keys">
              <span>Q</span>
              <span>J</span>
              <span>K</span>
              <span>F</span>
              <span>P</span>
            </div>
            <div class="typing-drills-sparks">
              <span></span>
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
          <div class="typing-drills-panel">
            <div class="typing-drills-modes" role="tablist" aria-label="Typing drill modes">
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="lesson"
                aria-selected="true"
                role="tab"
              >
                <span class="mode-label">Lesson</span>
                <span class="mode-meta">Curriculum step</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="burst"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Burst Warmup</span>
                <span class="mode-meta">5 quick words</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="warmup"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">5-Min Warm-up</span>
                <span class="mode-meta">Personal plan</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="endurance"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Endurance</span>
                <span class="mode-meta">30s cadence</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="sprint"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Time Attack</span>
                <span class="mode-meta">60s sprint</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="sentences"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Sentence Builder</span>
                <span class="mode-meta">Punctuation flow</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="reading"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Reading Quiz</span>
                <span class="mode-meta">Passage + quick quiz</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="rhythm"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Rhythm Drill</span>
                <span class="mode-meta">Alternating beat</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="reaction"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Reaction Challenge</span>
                <span class="mode-meta">Random cues</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="combo"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Combo Preservation</span>
                <span class="mode-meta">Limited mistakes</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="precision"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Shield Breaker</span>
                <span class="mode-meta">Hard-focus strings</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="symbols"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Numbers &amp; Symbols</span>
                <span class="mode-meta">Digits + punctuation</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="placement"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Placement Test</span>
                <span class="mode-meta">Left/right diagnostic</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="hand"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Hand Isolation</span>
                <span class="mode-meta">One hand at a time</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="support"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Lane Support</span>
                <span class="mode-meta">Type A/B/C fast</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="shortcuts"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Shortcut Practice</span>
                <span class="mode-meta">Ctrl/Cmd combos</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="shift"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Shift Timing</span>
                <span class="mode-meta">Hold vs tap cues</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="focus"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Focus Drill</span>
                <span class="mode-meta">Trouble keys</span>
              </button>
            </div>
            <div class="typing-drill-mastery" aria-label="Finger mastery tree">
              <div class="typing-drill-mastery-header">
                <div>
                  <span class="typing-drill-mastery-kicker">Finger mastery tree</span>
                  <span id="typing-drill-mastery-target" class="typing-drill-mastery-target"></span>
                </div>
                <p class="typing-drill-mastery-note">
                  Unlock new drills by keeping each finger accurate and steady.
                </p>
              </div>
              <div class="typing-drill-mastery-tree" role="list">
                <div class="typing-drill-mastery-node" data-finger="left-pinky" role="listitem">
                  <div class="typing-drill-mastery-ring">
                    <span class="typing-drill-mastery-tag">LP</span>
                  </div>
                  <div class="typing-drill-mastery-info">
                    <span class="typing-drill-mastery-label">Left Pinky</span>
                    <span class="typing-drill-mastery-stats">Acc -- / Tempo --</span>
                  </div>
                </div>
                <div class="typing-drill-mastery-node" data-finger="left-ring" role="listitem">
                  <div class="typing-drill-mastery-ring">
                    <span class="typing-drill-mastery-tag">LR</span>
                  </div>
                  <div class="typing-drill-mastery-info">
                    <span class="typing-drill-mastery-label">Left Ring</span>
                    <span class="typing-drill-mastery-stats">Acc -- / Tempo --</span>
                  </div>
                </div>
                <div class="typing-drill-mastery-node" data-finger="left-middle" role="listitem">
                  <div class="typing-drill-mastery-ring">
                    <span class="typing-drill-mastery-tag">LM</span>
                  </div>
                  <div class="typing-drill-mastery-info">
                    <span class="typing-drill-mastery-label">Left Middle</span>
                    <span class="typing-drill-mastery-stats">Acc -- / Tempo --</span>
                  </div>
                </div>
                <div class="typing-drill-mastery-node" data-finger="left-index" role="listitem">
                  <div class="typing-drill-mastery-ring">
                    <span class="typing-drill-mastery-tag">LI</span>
                  </div>
                  <div class="typing-drill-mastery-info">
                    <span class="typing-drill-mastery-label">Left Index</span>
                    <span class="typing-drill-mastery-stats">Acc -- / Tempo --</span>
                  </div>
                </div>
                <div class="typing-drill-mastery-node" data-finger="right-index" role="listitem">
                  <div class="typing-drill-mastery-ring">
                    <span class="typing-drill-mastery-tag">RI</span>
                  </div>
                  <div class="typing-drill-mastery-info">
                    <span class="typing-drill-mastery-label">Right Index</span>
                    <span class="typing-drill-mastery-stats">Acc -- / Tempo --</span>
                  </div>
                </div>
                <div class="typing-drill-mastery-node" data-finger="right-middle" role="listitem">
                  <div class="typing-drill-mastery-ring">
                    <span class="typing-drill-mastery-tag">RM</span>
                  </div>
                  <div class="typing-drill-mastery-info">
                    <span class="typing-drill-mastery-label">Right Middle</span>
                    <span class="typing-drill-mastery-stats">Acc -- / Tempo --</span>
                  </div>
                </div>
                <div class="typing-drill-mastery-node" data-finger="right-ring" role="listitem">
                  <div class="typing-drill-mastery-ring">
                    <span class="typing-drill-mastery-tag">RR</span>
                  </div>
                  <div class="typing-drill-mastery-info">
                    <span class="typing-drill-mastery-label">Right Ring</span>
                    <span class="typing-drill-mastery-stats">Acc -- / Tempo --</span>
                  </div>
                </div>
                <div class="typing-drill-mastery-node" data-finger="right-pinky" role="listitem">
                  <div class="typing-drill-mastery-ring">
                    <span class="typing-drill-mastery-tag">RP</span>
                  </div>
                  <div class="typing-drill-mastery-info">
                    <span class="typing-drill-mastery-label">Right Pinky</span>
                    <span class="typing-drill-mastery-stats">Acc -- / Tempo --</span>
                  </div>
                </div>
              </div>
              <div class="typing-drill-mastery-unlocks" role="list" aria-label="Drill unlocks">
                <div class="typing-drill-mastery-unlock" data-mode="reaction" role="listitem">
                  <span class="typing-drill-mastery-unlock-label">Reaction Challenge</span>
                  <span class="typing-drill-mastery-unlock-meta">Index fingers steady</span>
                </div>
                <div class="typing-drill-mastery-unlock" data-mode="rhythm" role="listitem">
                  <span class="typing-drill-mastery-unlock-label">Rhythm Drill</span>
                  <span class="typing-drill-mastery-unlock-meta">Middle fingers steady</span>
                </div>
                <div class="typing-drill-mastery-unlock" data-mode="combo" role="listitem">
                  <span class="typing-drill-mastery-unlock-label">Combo Preservation</span>
                  <span class="typing-drill-mastery-unlock-meta">Ring fingers steady</span>
                </div>
                <div class="typing-drill-mastery-unlock" data-mode="symbols" role="listitem">
                  <span class="typing-drill-mastery-unlock-label">Numbers &amp; Symbols</span>
                  <span class="typing-drill-mastery-unlock-meta">Pinky fingers steady</span>
                </div>
                <div class="typing-drill-mastery-unlock" data-mode="precision" role="listitem">
                  <span class="typing-drill-mastery-unlock-label">Shield Breaker</span>
                  <span class="typing-drill-mastery-unlock-meta">All fingers steady</span>
                </div>
              </div>
            </div>
            <div
              id="typing-drill-lesson-picker"
              class="typing-drill-lesson-picker"
              data-visible="false"
              aria-hidden="true"
            >
              <div class="typing-drill-lesson-header">
                <span class="typing-drill-lesson-kicker">Lesson Focus</span>
                <span class="typing-drill-lesson-meta">Follow the core progression.</span>
              </div>
              <label class="typing-drill-lesson-label" for="typing-drill-lesson-select">
                Choose lesson
              </label>
              <select id="typing-drill-lesson-select" class="typing-drill-lesson-select"></select>
              <p id="typing-drill-lesson-description" class="typing-drill-lesson-description"></p>
            </div>
            <div class="typing-drill-stage">
              <div class="typing-drill-status">
                <span class="typing-drill-status-label" id="typing-drill-status-label">Ready</span>
                <span class="typing-drill-progress" id="typing-drill-progress"></span>
                <button
                  id="typing-drill-slowmo"
                  class="ghost typing-drill-slowmo"
                  type="button"
                  data-visible="false"
                  aria-pressed="true"
                >
                  Slow-mo: On
                </button>
                <button
                  id="typing-drill-metronome"
                  class="ghost typing-drill-slowmo typing-drill-metronome"
                  type="button"
                  data-visible="false"
                  aria-pressed="true"
                >
                  Metronome: On
                </button>
                <button
                  id="typing-drill-hand"
                  class="ghost typing-drill-slowmo typing-drill-hand"
                  type="button"
                  data-visible="false"
                  aria-pressed="true"
                >
                  Hand: Left
                </button>
                <span class="typing-drill-timer" id="typing-drill-timer">00:00</span>
              </div>
              <div class="typing-drill-target" id="typing-drill-target"></div>
              <div class="typing-drill-input-row">
                <input
                  id="typing-drill-input"
                  type="text"
                  inputmode="text"
                  autocomplete="off"
                  autocapitalize="none"
                  spellcheck="false"
                  placeholder="Type to strike..."
                />
                <button id="typing-drill-start" class="primary" type="button">Start Drill</button>
                <button id="typing-drill-reset" class="ghost" type="button">Reset</button>
              </div>
              <p class="typing-drill-focus-hint" aria-hidden="true">
                Tip: Tap the field above to focus and raise your keyboard on mobile.
              </p>
              <div class="typing-drill-metrics">
                <div>
                  <span class="metric-label">Accuracy</span>
                  <span class="metric-value" id="typing-drill-accuracy">100%</span>
                </div>
                <div>
                  <span class="metric-label">Combo</span>
                  <span class="metric-value" id="typing-drill-combo">x0</span>
                </div>
                <div>
                  <span class="metric-label">WPM</span>
                  <span class="metric-value" id="typing-drill-wpm">0</span>
                </div>
                <div>
                  <span class="metric-label">Words</span>
                  <span class="metric-value" id="typing-drill-words">0</span>
                </div>
              </div>
              <div class="typing-drill-summary" id="typing-drill-summary" data-visible="false">
                <p class="summary-title">Drill Summary</p>
                <ul>
                  <li>
                    <span>Elapsed</span><span id="typing-drill-summary-time">0s</span>
                  </li>
                  <li>
                    <span>Accuracy</span><span id="typing-drill-summary-accuracy">100%</span>
                  </li>
                  <li>
                    <span>Best Combo</span><span id="typing-drill-summary-combo">x0</span>
                  </li>
                  <li>
                    <span>Words Cleared</span><span id="typing-drill-summary-words">0</span>
                  </li>
                  <li>
                    <span>Errors</span><span id="typing-drill-summary-errors">0</span>
                  </li>
                  <li hidden>
                    <span>Left Hand</span><span id="typing-drill-summary-left"></span>
                  </li>
                  <li hidden>
                    <span>Right Hand</span><span id="typing-drill-summary-right"></span>
                  </li>
                  <li hidden>
                    <span>Suggested Pace</span><span id="typing-drill-summary-pacing"></span>
                  </li>
                </ul>
                <div class="summary-medal" id="typing-drill-summary-medal" data-tier="bronze">
                  <p class="summary-medal__label" id="typing-drill-summary-medal-label">
                    Bronze medal earned
                  </p>
                  <p class="summary-medal__hint" id="typing-drill-summary-medal-hint">
                    Replay drills to chase the next tier.
                  </p>
                  <button id="typing-drill-summary-replay" class="secondary" type="button">
                    Replay drill
                  </button>
                </div>
                <p class="summary-tip" id="typing-drill-summary-tip"></p>
              </div>
            </div>
          </div>
      </div>
    </div>
  </div>
    <div
      id="sticker-overlay"
      class="sticker-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="sticker-overlay-title"
      aria-hidden="true"
    >
      <div class="sticker-overlay-card">
        <header class="sticker-overlay-header">
          <div>
            <p class="sticker-overlay-kicker">Season 4 keepsakes</p>
            <h2 id="sticker-overlay-title">Sticker Book</h2>
            <p id="sticker-overlay-summary" class="sticker-overlay-summary">
              Collect pixel stickers by hitting milestones across runs.
            </p>
          </div>
          <button
            id="sticker-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close sticker book"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="sticker-overlay-body">
          <ul id="sticker-overlay-list" class="sticker-grid" role="list"></ul>
        </div>
      </div>
    </div>
    <div
      id="music-overlay"
      class="sfx-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="music-overlay-title"
      aria-hidden="true"
    >
      <div class="sfx-overlay-card">
        <header class="sfx-overlay-header">
          <div>
            <p class="sfx-overlay-kicker">Dynamic music</p>
            <h2 id="music-overlay-title">Music Suites</h2>
            <p id="music-overlay-summary" class="sfx-overlay-summary">
              Pick a music suite to layer stems by wave danger.
            </p>
          </div>
          <button
            id="music-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close music library"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="sfx-overlay-body">
          <div id="music-overlay-list" class="sfx-grid" role="list"></div>
        </div>
      </div>
    </div>
    <div
      id="ui-sound-overlay"
      class="sfx-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="ui-sound-overlay-title"
      aria-hidden="true"
    >
      <div class="sfx-overlay-card">
        <header class="sfx-overlay-header">
          <div>
            <p class="sfx-overlay-kicker">Interface cues</p>
            <h2 id="ui-sound-overlay-title">UI Sound Sets</h2>
            <p id="ui-sound-overlay-summary" class="sfx-overlay-summary">
              Pick a tone set for menus, overlays, and alerts.
            </p>
          </div>
          <button
            id="ui-sound-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close UI sounds library"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="sfx-overlay-body">
          <div id="ui-sound-overlay-list" class="sfx-grid" role="list"></div>
        </div>
      </div>
    </div>
    <div
      id="sfx-overlay"
      class="sfx-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="sfx-overlay-title"
      aria-hidden="true"
    >
      <div class="sfx-overlay-card">
        <header class="sfx-overlay-header">
          <div>
            <p class="sfx-overlay-kicker">Audio refresh</p>
            <h2 id="sfx-overlay-title">SFX Library</h2>
            <p id="sfx-overlay-summary" class="sfx-overlay-summary">
              Preview refreshed projectile, impact, and upgrade mixes before activating.
            </p>
          </div>
          <button id="sfx-overlay-close" class="icon-button" type="button" aria-label="Close SFX library">
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="sfx-overlay-body">
          <div id="sfx-overlay-list" class="sfx-grid" role="list"></div>
        </div>
      </div>
    </div>
    <div
      id="readability-overlay"
      class="readability-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="readability-overlay-title"
      aria-hidden="true"
    >
      <div class="readability-overlay-card">
        <header class="readability-overlay-header">
          <div>
            <p class="readability-overlay-kicker">Clarity first</p>
            <h2 id="readability-overlay-title">Enemy Readability Guide</h2>
            <p id="readability-overlay-summary" class="readability-overlay-summary">
              Updated silhouettes, color tags, and quick tips so every threat stays readable.
            </p>
          </div>
          <button
            id="readability-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close readability guide"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="readability-overlay-body">
          <div class="readability-overlay-legend" aria-hidden="true">
            <span class="legend-chip legend-chip--silhouette">Silhouette</span>
            <span class="legend-chip legend-chip--accent">Accent glow</span>
            <span class="legend-chip legend-chip--tag">Tier color</span>
          </div>
          <div id="readability-overlay-list" class="readability-grid" role="list"></div>
        </div>
      </div>
    </div>
    <div
      id="posture-overlay"
      class="posture-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="posture-overlay-title"
      aria-hidden="true"
    >
      <div class="posture-overlay-card">
        <header class="posture-overlay-header">
          <div>
            <p class="posture-overlay-kicker">Stay aligned</p>
            <h2 id="posture-overlay-title">Posture Checklist</h2>
            <p id="posture-overlay-summary" class="posture-overlay-summary">
              Quick pre-wave posture reset with an optional 5-minute reminder.
            </p>
          </div>
          <button
            id="posture-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close posture checklist"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="posture-overlay-body">
          <ul id="posture-overlay-list" class="posture-checklist" role="list">
            <li data-posture="feet">Feet flat, chair height keeps knees at 90°.</li>
            <li data-posture="wrists">Wrists lifted above the desk; float over home row.</li>
            <li data-posture="shoulders">Shoulders down and relaxed; elbows near 90°.</li>
            <li data-posture="screen">Screen at eye height and one arm away.</li>
            <li data-posture="breathing">Breathe steady; light taps to keep hands loose.</li>
          </ul>
          <div class="posture-actions">
            <div class="posture-actions-left">
              <button id="posture-overlay-start" class="primary" type="button">
                Start 5-minute reminder
              </button>
              <button id="posture-overlay-review" class="ghost" type="button">
                Mark reviewed
              </button>
            </div>
            <div class="posture-actions-right">
              <p id="posture-overlay-status" class="posture-status">No reminder active.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      id="subtitle-overlay"
      class="subtitle-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="subtitle-overlay-title"
      aria-hidden="true"
    >
      <div class="subtitle-overlay-card">
        <header class="subtitle-overlay-header">
          <div>
            <p class="subtitle-overlay-kicker">Readable voice lines</p>
            <h2 id="subtitle-overlay-title">Large-Text Subtitles</h2>
            <p id="subtitle-overlay-summary" class="subtitle-overlay-summary">
              Enable large subtitles to boost size and contrast for dialogue and taunts.
            </p>
          </div>
          <button
            id="subtitle-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close subtitle preview"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="subtitle-overlay-body">
          <label class="option-toggle">
            <input id="subtitle-overlay-toggle" type="checkbox" />
            <span class="option-toggle-label">Use Large Subtitles</span>
            <span class="option-toggle-help">
              Makes subtitles larger with extra line spacing and higher contrast.
            </span>
          </label>
          <div id="subtitle-overlay-samples" class="subtitle-samples">
            <p class="subtitle-line" data-subtitle-line>
              [Commander] Focus fire on the shielded crawler. Turrets marked in green are ready.
            </p>
            <p class="subtitle-line" data-subtitle-line>
              [Scholar] Remember: tap lightly, keep wrists floating, and breathe between waves.
            </p>
            <p class="subtitle-line" data-subtitle-line>
              [Enemy] You cannot hold the west gate forever—our next wave brings siege engines!
            </p>
          </div>
        </div>
      </div>
    </div>
    <div
      id="layout-overlay"
      class="layout-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="layout-overlay-title"
      aria-hidden="true"
    >
      <div class="layout-overlay-card">
        <header class="layout-overlay-header">
          <div>
            <p class="layout-overlay-kicker">Try before you switch</p>
            <h2 id="layout-overlay-title">HUD Layout Preview</h2>
            <p id="layout-overlay-summary" class="layout-overlay-summary">
              Right-handed layout active. HUD anchors right; canvas stays on the left.
            </p>
          </div>
          <button
            id="layout-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close layout preview"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="layout-overlay-body">
          <div class="layout-preview-grid">
            <div id="layout-overlay-left" class="layout-preview-card" data-side="left">
              <div class="layout-preview-head">
                <span class="layout-pill layout-pill--left">Left-handed</span>
                <span class="layout-preview-caption">HUD on the left, canvas on the right.</span>
              </div>
              <div class="layout-preview-canvas">
                <div class="layout-preview-hud layout-preview-hud--left">
                  <span class="layout-preview-label">HUD</span>
                </div>
                <div class="layout-preview-playfield">Playfield</div>
              </div>
              <button id="layout-apply-left" class="primary" type="button">Use Left Layout</button>
            </div>
            <div id="layout-overlay-right" class="layout-preview-card" data-side="right">
              <div class="layout-preview-head">
                <span class="layout-pill layout-pill--right">Right-handed</span>
                <span class="layout-preview-caption">HUD on the right, canvas on the left.</span>
              </div>
              <div class="layout-preview-canvas">
                <div class="layout-preview-playfield">Playfield</div>
                <div class="layout-preview-hud layout-preview-hud--right">
                  <span class="layout-preview-label">HUD</span>
                </div>
              </div>
              <button id="layout-apply-right" class="secondary" type="button">
                Use Right Layout
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      id="scrolls-overlay"
      class="scrolls-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="scrolls-overlay-title"
      aria-hidden="true"
    >
      <div class="scrolls-overlay-card">
        <header class="scrolls-overlay-header">
          <div>
            <p class="scrolls-overlay-kicker">Reading rewards</p>
            <h2 id="scrolls-overlay-title">Lore Scrolls</h2>
            <p id="scrolls-overlay-summary" class="scrolls-overlay-summary">
              Unlock scrolls by completing lessons, then read them between waves.
            </p>
            <p id="scrolls-overlay-progress" class="scrolls-overlay-progress">
              0 lessons completed · 0 / 0 scrolls unlocked
            </p>
          </div>
          <button
            id="scrolls-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close lore scrolls"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="scrolls-toolbar">
          <div class="scrolls-filters" role="group" aria-label="Filter scrolls">
            <button
              id="scrolls-filter-all"
              type="button"
              class="scrolls-filter"
              data-scroll-filter="all"
              aria-pressed="true"
            >
              All
            </button>
            <button
              id="scrolls-filter-unlocked"
              type="button"
              class="scrolls-filter"
              data-scroll-filter="unlocked"
              aria-pressed="false"
            >
              Unlocked
            </button>
            <button
              id="scrolls-filter-locked"
              type="button"
              class="scrolls-filter"
              data-scroll-filter="locked"
              aria-pressed="false"
            >
              Locked
            </button>
          </div>
          <label class="scrolls-search">
            <span class="scrolls-search__label">Search</span>
            <input
              id="scrolls-overlay-search"
              type="search"
              placeholder="Find a scroll..."
              aria-label="Search scroll titles and summaries"
            />
          </label>
        </div>
        <div class="scrolls-overlay-body">
          <ul id="scrolls-overlay-list" class="scrolls-grid" role="list"></ul>
        </div>
      </div>
    </div>
    <div
      id="season-track-overlay"
      class="season-track-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="season-track-title"
      aria-hidden="true"
    >
      <div class="season-track-overlay-card">
        <header class="season-track-header">
          <div>
            <p class="season-track-kicker">Season 4</p>
            <h2 id="season-track-title">Free Reward Track</h2>
            <p id="season-track-subtitle" class="season-track-subtitle">
              Predictable unlocks—no random rolls.
            </p>
          </div>
          <button
            id="season-track-close"
            class="icon-button"
            type="button"
            aria-label="Close season track"
          >
            ×
          </button>
        </header>
        <div class="season-track-body">
          <div class="season-track-meta">
            <p id="season-track-overlay-progress" class="season-track-progress">
              0 of 0 rewards unlocked
            </p>
            <p id="season-track-overlay-lessons" class="season-track-lessons">0 lessons completed</p>
            <p id="season-track-overlay-next" class="season-track-next">
              Keep completing lessons to unlock your next reward.
            </p>
          </div>
          <ul id="season-track-list" class="season-track-list" role="list"></ul>
        </div>
      </div>
    </div>
    <div
      id="mastery-certificate-overlay"
      class="mastery-cert-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="mastery-certificate-title"
      aria-hidden="true"
    >
      <div class="mastery-cert-overlay-card">
        <header class="mastery-cert-header">
          <div>
            <p class="mastery-cert-kicker">Celebrate progress</p>
            <h2 id="mastery-certificate-title">Mastery Certificate</h2>
            <p id="mastery-certificate-subtitle" class="mastery-cert-subtitle">
              Printable snapshot of lessons and accuracy.
            </p>
          </div>
          <div class="mastery-cert-toolbar">
            <button id="mastery-certificate-download" class="primary" type="button">
              Download / Print
            </button>
            <button
              id="mastery-certificate-close"
              class="icon-button"
              type="button"
              aria-label="Close mastery certificate"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        </header>
        <div class="mastery-cert-body">
          <label class="mastery-cert-name">
            <span>Learner name</span>
            <input
              id="mastery-certificate-name-input"
              type="text"
              placeholder="Enter learner name"
              autocomplete="name"
            />
          </label>
          <p id="mastery-certificate-overlay-summary" class="mastery-cert-summary">
            Complete a session to generate a mastery certificate.
          </p>
          <div class="mastery-cert-summary-grid" id="mastery-certificate-summary-grid">
            <div class="mastery-cert-stat" data-metric="lessons">
              <p class="mastery-cert-stat__label">Lessons</p>
              <p class="mastery-cert-stat__value" id="mastery-certificate-stat-lessons">0</p>
            </div>
            <div class="mastery-cert-stat" data-metric="accuracy">
              <p class="mastery-cert-stat__label">Accuracy</p>
              <p class="mastery-cert-stat__value" id="mastery-certificate-stat-accuracy">0%</p>
            </div>
            <div class="mastery-cert-stat" data-metric="wpm">
              <p class="mastery-cert-stat__label">WPM</p>
              <p class="mastery-cert-stat__value" id="mastery-certificate-stat-wpm">0</p>
            </div>
            <div class="mastery-cert-stat" data-metric="combo">
              <p class="mastery-cert-stat__label">Combo</p>
              <p class="mastery-cert-stat__value" id="mastery-certificate-stat-combo">x0</p>
            </div>
            <div class="mastery-cert-stat" data-metric="drills">
              <p class="mastery-cert-stat__label">Drills</p>
              <p class="mastery-cert-stat__value" id="mastery-certificate-stat-drills">0</p>
            </div>
            <div class="mastery-cert-stat" data-metric="time">
              <p class="mastery-cert-stat__label">Time</p>
              <p class="mastery-cert-stat__value" id="mastery-certificate-stat-time">0m</p>
            </div>
          </div>
          <p id="mastery-certificate-overlay-date" class="mastery-cert-date"></p>
          <section class="mastery-cert-details" id="mastery-cert-details" data-collapsed="true">
            <div class="mastery-cert-details-header">
              <div class="mastery-cert-details-copy">
                <p class="mastery-cert-details-title">Session breakdown</p>
                <p class="mastery-cert-details-note">Toggle for full stats</p>
              </div>
              <button
                id="mastery-cert-details-toggle"
                class="ghost"
                type="button"
                aria-expanded="false"
              >
                Expand
              </button>
            </div>
            <div class="mastery-cert-details-body">
              <ul id="mastery-certificate-stats-list" class="mastery-cert-stats" role="list"></ul>
            </div>
          </section>
        </div>
      </div>
    </div>
    <div
      id="milestone-celebration"
      class="milestone-celebration"
      data-visible="false"
      aria-hidden="true"
      role="status"
      aria-live="polite"
    >
      <div class="milestone-celebration__backdrop" aria-hidden="true"></div>
      <div class="milestone-celebration__sparks" aria-hidden="true"></div>
      <div class="milestone-celebration__content">
        <div id="milestone-celebration-badge" class="milestone-celebration__badge">Milestone</div>
        <div class="milestone-celebration__copy">
          <p id="milestone-celebration-eyebrow" class="milestone-celebration__eyebrow">
            Goal reached
          </p>
          <h3 id="milestone-celebration-title" class="milestone-celebration__title">
            Milestone unlocked
          </h3>
          <p id="milestone-celebration-detail" class="milestone-celebration__detail">
            Keep up the momentum!
          </p>
        </div>
        <button
          id="milestone-celebration-close"
          class="icon-button"
          type="button"
          aria-label="Close celebration"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
    <div
      id="museum-overlay"
      class="museum-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="museum-overlay-title"
      aria-hidden="true"
    >
      <div class="museum-card">
        <header class="museum-header">
          <div>
            <p class="museum-kicker">Castle Museum</p>
            <h2 id="museum-overlay-title">Unlocked Artifacts</h2>
            <p id="museum-overlay-subtitle" class="museum-subtitle">
              View the art, skins, and keepsakes you've earned.
            </p>
          </div>
          <button id="museum-close" class="icon-button" type="button" aria-label="Close castle museum">
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="museum-toolbar">
          <div class="museum-filters" role="group" aria-label="Filter museum entries">
            <button type="button" class="museum-filter" data-museum-filter="all" aria-pressed="true">
              All
            </button>
            <button type="button" class="museum-filter" data-museum-filter="unlocked" aria-pressed="false">
              Unlocked
            </button>
            <button type="button" class="museum-filter" data-museum-filter="locked" aria-pressed="false">
              Locked
            </button>
          </div>
          <p class="museum-toolbar-hint">Filters keep the gallery compact; use Tab to move between sections.</p>
        </div>
        <div class="museum-grid" id="museum-list" role="list"></div>
      </div>
    </div>
        <div
          id="side-quest-overlay"
          class="quest-overlay"
          data-visible="false"
          role="dialog"
      aria-modal="true"
      aria-labelledby="side-quest-overlay-title"
      aria-hidden="true"
        >
          <div class="quest-card">
            <header class="quest-header">
              <div>
                <p class="quest-kicker">Side quests</p>
                <h2 id="side-quest-overlay-title">Quest Log</h2>
                <p id="side-quest-overlay-subtitle" class="quest-subtitle">
                  Optional objectives to guide your next run.
                </p>
              </div>
              <button id="side-quest-close" class="icon-button" type="button" aria-label="Close quest log">
                <span aria-hidden="true">&times;</span>
              </button>
            </header>
            <div class="quest-toolbar">
              <div class="quest-filters" role="group" aria-label="Filter quests">
                <button type="button" class="quest-filter" data-quest-filter="all" aria-pressed="true">
                  All
                </button>
                <button type="button" class="quest-filter" data-quest-filter="active" aria-pressed="false">
                  Active
                </button>
                <button type="button" class="quest-filter" data-quest-filter="completed" aria-pressed="false">
                  Completed
                </button>
              </div>
              <p class="quest-toolbar-hint">Filters help condense the list; press Tab to reach results.</p>
            </div>
            <div id="side-quest-list" class="quest-grid" role="list"></div>
          </div>
        </div>
    <div
      id="lesson-medal-overlay"
      class="lesson-medal-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="lesson-medal-title"
      aria-hidden="true"
    >
      <div class="lesson-medal-card">
        <header class="lesson-medal-header">
          <div>
            <p class="lesson-medal-kicker">Lesson milestones</p>
            <h2 id="lesson-medal-title">Medal Board</h2>
            <p id="lesson-medal-subtitle" class="lesson-medal-subtitle">
              Bronze, Silver, Gold, and Platinum medals tied to each drill.
            </p>
          </div>
          <button
            id="lesson-medal-close"
            class="icon-button"
            type="button"
            aria-label="Close lesson medals"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="lesson-medal-body">
          <div class="lesson-medal-banner">
            <div id="lesson-medal-overlay-badge" class="lesson-medal-badge" data-tier="bronze">
              Bronze
            </div>
            <div class="lesson-medal-banner__copy">
              <p id="lesson-medal-overlay-last" class="lesson-medal-last">
                Complete a typing drill to claim your first medal.
              </p>
              <p id="lesson-medal-overlay-next" class="lesson-medal-next">
                Replay drills to chase the next tier.
              </p>
            </div>
            <button id="lesson-medal-replay" class="secondary" type="button">Replay drill</button>
          </div>
          <div id="lesson-medal-best-list" class="lesson-medal-grid" role="list"></div>
          <div class="lesson-medal-history">
            <p class="lesson-medal-history__title">Recent runs</p>
            <ul id="lesson-medal-history-list" class="lesson-medal-history-list" role="list"></ul>
          </div>
        </div>
      </div>
    </div>
    <div
      id="wpm-ladder-overlay"
      class="wpm-ladder-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="wpm-ladder-title"
      aria-hidden="true"
    >
      <div class="wpm-ladder-dialog">
        <header class="wpm-ladder-header">
          <div>
            <p class="wpm-ladder-kicker">Personal records</p>
            <h2 id="wpm-ladder-title">WPM Ladder</h2>
            <p id="wpm-ladder-subtitle" class="wpm-ladder-subtitle">
              Tracks your fastest drills per mode. Stored locally.
            </p>
            <p id="wpm-ladder-meta" class="wpm-ladder-meta">No runs recorded yet.</p>
          </div>
          <button id="wpm-ladder-close" class="icon-button" type="button" aria-label="Close WPM ladder">
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div id="wpm-ladder-list" class="wpm-ladder-grid" role="list"></div>
      </div>
    </div>
    <div
      id="biome-overlay"
      class="biome-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="biome-overlay-title"
      aria-hidden="true"
    >
      <div class="biome-dialog">
        <header class="biome-header">
          <div>
            <p class="biome-kicker">Pixel biome expansion</p>
            <h2 id="biome-overlay-title">Biome Gallery</h2>
            <p id="biome-overlay-subtitle" class="biome-subtitle">
              Choose a biome and track your runs per backdrop.
            </p>
            <p id="biome-overlay-meta" class="biome-meta">No biome selected yet.</p>
          </div>
          <button
            id="biome-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close biome gallery"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div id="biome-overlay-list" class="biome-grid" role="list"></div>
      </div>
    </div>
    <div
      id="training-calendar-overlay"
      class="training-calendar-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="training-calendar-title"
      aria-hidden="true"
    >
      <div class="training-calendar-dialog">
        <header class="training-calendar-header">
          <div>
            <p class="training-calendar-kicker">Habit tracker</p>
            <h2 id="training-calendar-title">Training Calendar</h2>
            <p id="training-calendar-subtitle" class="training-calendar-subtitle">
              Lessons and drills tracked per day.
            </p>
            <p id="training-calendar-legend" class="training-calendar-legend">
              Darker tiles = more sessions.
            </p>
          </div>
          <button
            id="training-calendar-close"
            class="icon-button"
            type="button"
            aria-label="Close training calendar"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div id="training-calendar-grid" class="training-calendar-grid" role="list"></div>
      </div>
    </div>
    <div
      id="parent-summary-overlay"
      class="parent-summary-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="parent-summary-title"
      aria-hidden="true"
    >
      <div class="parent-summary-card">
        <header class="parent-summary-header">
          <div>
            <p class="parent-summary-kicker">For parents & mentors</p>
            <h2 id="parent-summary-title">Weekly Summary</h2>
            <p id="parent-summary-subtitle" class="parent-summary-subtitle">
              Session highlights for the week.
            </p>
          </div>
          <button
            id="parent-summary-close"
            class="icon-button"
            type="button"
            aria-label="Close parent summary"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div class="parent-summary-body">
          <div class="parent-summary-meta">
            <p id="parent-summary-progress" class="parent-summary-progress">
              0 minutes practiced · 0% accuracy · 0 WPM
            </p>
            <p id="parent-summary-note" class="parent-summary-note">
              Tip: keep sessions around 20-30 minutes with short stretch breaks.
            </p>
          </div>
          <ul class="parent-summary-metrics" role="list">
            <li>
              <span>Time practiced</span>
              <span id="parent-summary-time">0 minutes</span>
            </li>
            <li>
              <span>Average accuracy</span>
              <span id="parent-summary-accuracy">0%</span>
            </li>
            <li>
              <span>Average WPM</span>
              <span id="parent-summary-wpm">0</span>
            </li>
            <li>
              <span>Best combo</span>
              <span id="parent-summary-combo">x0</span>
            </li>
            <li>
              <span>Perfect words</span>
              <span id="parent-summary-perfect">0</span>
            </li>
            <li>
              <span>Castle breaches</span>
              <span id="parent-summary-breaches">0</span>
            </li>
            <li>
              <span>Typing drills completed</span>
              <span id="parent-summary-drills">0</span>
            </li>
            <li>
              <span>Repairs used</span>
              <span id="parent-summary-repairs">0</span>
            </li>
          </ul>
          <div class="parent-summary-actions">
            <button id="parent-summary-download" class="primary" type="button">
              Download PDF
            </button>
            <button id="parent-summary-close-secondary" class="ghost" type="button">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      id="contrast-overlay"
      data-visible="false"
      aria-hidden="true"
      aria-live="polite"
      role="region"
      aria-label="Contrast audit overlay"
    >
      <div class="contrast-overlay-card">
        <header class="contrast-overlay-header">
          <div>
            <p class="contrast-overlay-kicker">Visual check</p>
            <h2 class="contrast-overlay-title">Contrast Audit</h2>
            <p id="contrast-overlay-summary" class="contrast-overlay-summary">
              Running audit...
            </p>
          </div>
          <button id="contrast-overlay-close" class="icon-button" type="button" aria-label="Close contrast audit">
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <div id="contrast-overlay-body" class="contrast-overlay-body">
          <div id="contrast-overlay-markers" class="contrast-overlay-markers" aria-hidden="true"></div>
          <ul id="contrast-overlay-list" class="contrast-overlay-list"></ul>
        </div>
      </div>
    </div>
    <script type="module" src="../dist/src/index.js"></script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("sw.js").catch(() => {});
        });
      }
    </script>
  </body>
</html>
