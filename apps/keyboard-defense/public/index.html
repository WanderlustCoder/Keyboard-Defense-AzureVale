<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Keyboard Defense</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div
      id="loading-screen"
      data-visible="true"
      aria-live="polite"
      aria-busy="true"
      role="status"
    >
      <div class="loading-card">
        <div class="loading-pixel">
          <div class="loading-pixel-sprite" aria-hidden="true"></div>
        </div>
        <div class="loading-copy">
          <p class="loading-title">Forging defenses...</p>
          <p class="loading-status" id="loading-status">Loading pixel defenders...</p>
          <p class="loading-tip-label">Tip</p>
          <p class="loading-tip" id="loading-tip">Keep wrists relaxed and float above home row.</p>
        </div>
      </div>
    </div>
    <div id="app">
      <canvas id="game-surface" width="960" height="540"></canvas>
      <aside id="hud">
        <section
          class="tutorial-banner"
          id="tutorial-banner"
          data-visible="false"
          aria-live="polite"
        >
          <div class="tutorial-banner__content" data-role="tutorial-message"></div>
          <button
            type="button"
            class="tutorial-banner__toggle"
            data-role="tutorial-toggle"
            aria-expanded="false"
          >
            Show full tip
          </button>
        </section>
        <section class="castle">
          <div class="castle-header">
            <h1>Keyboard Defense</h1>
            <div class="castle-actions">
              <button id="fullscreen-button" type="button" aria-pressed="false" aria-label="Toggle fullscreen">
                Fullscreen
              </button>
              <button id="pause-button" type="button" aria-label="Pause game">Pause</button>
              <button id="roadmap-launch" type="button" aria-label="Open roadmap">Roadmap</button>
              <button
                id="shortcut-launch"
                class="icon-button"
                type="button"
                aria-label="Show keyboard shortcuts"
              >
                <span aria-hidden="true">?</span>
              </button>
            </div>
          </div>
          <div class="castle-health">
            <span id="castle-health-label">Castle Health</span>
            <div class="bar">
              <div class="fill" id="castle-health-bar"></div>
            </div>
          </div>
          <div class="resources">
            <span>Gold:</span>
            <span id="resource-gold">0</span>
            <span id="resource-delta"></span>
          </div>
          <div class="session-panel" aria-live="polite">
          <div class="session-row">
            <span class="session-label">Session</span>
            <span id="session-timer" class="session-time">00:00</span>
          </div>
          <div
            id="latency-indicator"
            class="latency-indicator"
            data-state="good"
            role="status"
            aria-live="polite"
            aria-label="Input latency good"
          >
            <span class="latency-dot" aria-hidden="true"></span>
            <span class="latency-label">Input latency</span>
            <span id="latency-value" class="latency-value">0ms</span>
          </div>
          <div
            id="break-reminder"
            class="break-reminder"
            data-visible="false"
            role="status"
              aria-live="polite"
              aria-hidden="true"
            >
              <div class="break-reminder-copy">
                <p class="break-reminder-title">Time for a stretch?</p>
                <p class="break-reminder-tip" id="break-reminder-tip">
                  You have been practicing for 20 minutes. Stand, stretch, and sip water.
                </p>
              </div>
              <div class="break-reminder-actions">
                <button id="break-reminder-snooze" type="button" aria-label="Snooze break reminder for 10 minutes">
                  Remind in 10m
                </button>
                <button id="break-reminder-reset" type="button" aria-label="Confirm break taken and reset timer">
                  I took a break
                </button>
              </div>
            </div>
          </div>
          <div class="upgrades" id="upgrade-panel"></div>
        </section>
        <section class="typing">
          <div id="active-word"></div>
          <div id="typing-metrics" aria-live="polite">
            <div class="typing-metric">
              <span class="typing-metric-label">Accuracy</span>
              <span class="typing-metric-value" id="typing-accuracy">100%</span>
            </div>
            <div class="typing-metric">
              <span class="typing-metric-label">WPM</span>
              <span class="typing-metric-value" id="typing-wpm">0</span>
            </div>
          </div>
          <div id="combo-stats">Combo x0</div>
          <div id="combo-accuracy-delta" role="status" aria-live="polite"></div>
          <input
            id="typing-input"
            autocomplete="off"
            autofocus
            placeholder="Type to attack..."
            aria-label="Typing input. Type the on-screen words to attack."
          />
          <div id="finger-hint" class="finger-hint" data-visible="false" role="status" aria-live="polite"></div>
          <div
            id="caps-lock-warning"
            class="caps-lock-warning"
            data-visible="false"
            role="status"
            aria-live="polite"
            aria-hidden="true"
          >
            Caps Lock is on - accuracy may drop.
          </div>
          <div id="lock-indicators" class="lock-indicators" aria-live="polite" role="status">
            <span id="lock-indicator-caps" class="lock-indicator" data-active="false">Caps</span>
            <span id="lock-indicator-num" class="lock-indicator" data-active="false">Num</span>
          </div>
          <div
            id="virtual-keyboard"
            class="virtual-keyboard"
            data-visible="false"
            aria-hidden="true"
            aria-label="On-screen keyboard"
          ></div>
            <div class="typing-drills-cta" id="typing-drills-cta">
              <div class="typing-drills-cta-text">
                <p class="typing-drills-cta-title">Need a warmup?</p>
                <p class="typing-drills-cta-copy">
                  Run quick drills to lock in rhythm without risking the castle.
                </p>
                <p class="typing-drills-cta-hint">Shortcut: Shift + R to launch recommended drill</p>
            <p id="typing-drills-cta-reco" class="typing-drills-cta-reco" data-visible="false">
              Recommended: <span class="typing-drills-cta-reco-mode"></span>
            </p>
          </div>
          <button id="typing-drills-open" class="typing-drills-cta-button" type="button">
            Launch drills
          </button>
          <div
            id="hint-typing-drills"
            class="contextual-hint"
            data-visible="false"
            role="status"
            aria-live="polite"
          >
            <p class="contextual-hint-text">
              Hint: Use Shift + R to open drills before the next wave for a quick warmup.
            </p>
            <button type="button" class="contextual-hint-close" aria-label="Dismiss drills hint">
              ×
            </button>
          </div>
        </div>
        </section>
        <section class="wave-preview">
          <h2>Upcoming Enemies</h2>
          <div
            id="hint-wave-preview"
            class="contextual-hint"
            data-visible="false"
            role="status"
            aria-live="polite"
          >
            <p class="contextual-hint-text">
              Hint: Preview shows the next wave. Hover an enemy to read its role and tips.
            </p>
            <button type="button" class="contextual-hint-close" aria-label="Dismiss wave preview hint">
              ×
            </button>
          </div>
          <div
            id="wave-preview-hint"
            class="wave-preview-hint"
            role="status"
            aria-live="polite"
            aria-hidden="true"
            data-visible="false"
          ></div>
          <div id="wave-preview-list"></div>
          <div
            id="enemy-bio-card"
            class="enemy-bio-card"
            aria-live="polite"
            aria-hidden="true"
            data-visible="false"
          >
            <div class="enemy-bio-header">
              <div>
                <p id="enemy-bio-role" class="enemy-bio-role"></p>
                <h3 id="enemy-bio-title" class="enemy-bio-title"></h3>
              </div>
              <span id="enemy-bio-danger" class="enemy-bio-danger"></span>
            </div>
            <p id="enemy-bio-description" class="enemy-bio-description"></p>
            <div class="enemy-bio-columns">
              <div>
                <p class="enemy-bio-label">Abilities</p>
                <ul id="enemy-bio-abilities"></ul>
              </div>
              <div>
                <p class="enemy-bio-label">Tips</p>
                <ul id="enemy-bio-tips"></ul>
              </div>
            </div>
          </div>
        </section>
        <section
          id="roadmap-glance"
          class="roadmap-glance"
          data-visible="false"
          aria-live="polite"
          aria-hidden="true"
        >
          <div class="roadmap-glance-header">
            <h2>Season Roadmap</h2>
            <div class="roadmap-glance-actions">
              <button id="roadmap-glance-open" type="button" class="ghost-button">
                Open
              </button>
              <button id="roadmap-glance-clear" type="button" class="ghost-button">
                Clear
              </button>
            </div>
          </div>
          <p id="roadmap-glance-title" class="roadmap-glance-title"></p>
          <p id="roadmap-glance-progress" class="roadmap-glance-progress"></p>
        </section>
        <section class="events">
          <h2>Battle Log</h2>
          <div
            id="hint-battle-log"
            class="contextual-hint"
            data-visible="false"
            role="status"
            aria-live="polite"
          >
            <p class="contextual-hint-text">
              Hint: The battle log tracks pickups, breaches, and shields. Toggle it in Options.
            </p>
            <button type="button" class="contextual-hint-close" aria-label="Dismiss battle log hint">
              ×
            </button>
          </div>
          <ul id="battle-log"></ul>
        </section>
        <section class="debug">
          <details>
            <summary>Debug Hooks</summary>
            <button id="debug-pause">Pause</button>
            <button id="debug-resume">Resume</button>
            <button id="debug-step">Step Frame</button>
            <button id="debug-gold">+100 Gold</button>
            <button id="debug-crystal-toggle" type="button">Enable Crystal Pulse</button>
            <button id="debug-elite-toggle" type="button">Enable Elite Affixes</button>
            <button id="debug-turret-downgrade" type="button" aria-pressed="false">
              Enable Turret Downgrade
            </button>
            <button id="debug-spawn-dummy" type="button">Spawn Practice Dummy</button>
            <button id="debug-clear-dummies" type="button">Clear Practice Dummies</button>
            <div class="debug-wave-preview-row">
              <div class="debug-wave-preview-inputs">
                <label for="debug-wave-preview-url">Wave Preview URL</label>
                <input
                  id="debug-wave-preview-url"
                  type="url"
                  inputmode="url"
                  placeholder="http://localhost:4179/"
                  aria-label="Wave preview URL"
                />
                <button id="debug-wave-preview-save" type="button">Save URL</button>
              </div>
              <button id="debug-wave-preview" type="button">Open Wave Preview</button>
            </div>
            <button id="debug-diagnostics">Toggle Diagnostics</button>
            <button id="debug-sound">Toggle Sound</button>
            <div class="debug-sound-controls">
              <label class="debug-sound-controls-label" for="debug-sound-volume"
                >Sound volume</label
              >
              <input
                id="debug-sound-volume"
                class="debug-sound-controls-slider"
                type="range"
                min="0"
                max="1"
                step="0.01"
                value="0.8"
                aria-valuemin="0"
                aria-valuemax="1"
              />
              <span
                id="debug-sound-volume-value"
                class="debug-sound-controls-value"
                data-state="enabled"
                aria-live="polite"
              >
                80%
              </span>
              <label class="debug-sound-controls-label" for="debug-sound-intensity"
                >Audio intensity</label
              >
              <input
                id="debug-sound-intensity"
                class="debug-sound-controls-slider"
                type="range"
                min="0.5"
                max="1.5"
                step="0.01"
                value="1"
                aria-valuemin="0.5"
                aria-valuemax="1.5"
              />
              <span
                id="debug-sound-intensity-value"
                class="debug-sound-controls-value"
                data-state="enabled"
                aria-live="polite"
              >
                100%
              </span>
            </div>
            <button id="debug-analytics-reset">Reset Analytics</button>
            <button id="debug-analytics-export">Download Analytics</button>
            <button id="debug-analytics-viewer-toggle" type="button" aria-expanded="false">
              Show Analytics Viewer
            </button>
            <div
              id="debug-telemetry-controls"
              class="debug-telemetry-controls"
              aria-hidden="true"
              data-visible="false"
            >
              <p class="debug-telemetry-title">Telemetry</p>
              <div class="debug-telemetry-buttons">
                <button id="debug-telemetry-toggle" type="button" aria-pressed="false">
                  Enable Telemetry
                </button>
                <button id="debug-telemetry-flush" type="button">Flush Telemetry (0)</button>
                <button id="debug-telemetry-download" type="button">Download Telemetry (0)</button>
              </div>
              <label class="debug-telemetry-endpoint" for="debug-telemetry-endpoint">
                Endpoint
                <div class="debug-telemetry-endpoint-row">
                  <input
                    id="debug-telemetry-endpoint"
                    type="url"
                    inputmode="url"
                    placeholder="https://collector.example/ingest"
                    autocomplete="off"
                  />
                  <button id="debug-telemetry-endpoint-apply" type="button">Apply</button>
                </div>
              </label>
            </div>
            <button id="debug-tutorial-replay">Replay Tutorial</button>
            <div
              id="debug-analytics-viewer"
              data-visible="false"
              aria-hidden="true"
              aria-live="polite"
              role="region"
              aria-label="Recent wave analytics summaries"
            >
              <div class="analytics-viewer-controls">
                <label for="debug-analytics-viewer-filter">Show</label>
                <select id="debug-analytics-viewer-filter">
                  <option value="all">All waves</option>
                  <option value="last-5">Last 5</option>
                  <option value="last-10">Last 10</option>
                  <option value="breaches">Breaches</option>
                  <option value="shielded">Shield breaks</option>
                </select>
              </div>
              <div id="debug-analytics-drills" class="analytics-drills" aria-live="polite"></div>
              <table aria-describedby="debug-analytics-viewer-caption">
                <caption id="debug-analytics-viewer-caption">
                  Recent wave summaries
                </caption>
                <thead>
                  <tr>
                    <th scope="col">Wave</th>
                    <th scope="col">Mode</th>
                    <th scope="col">Accuracy</th>
                    <th scope="col">Breaches</th>
                    <th scope="col">Defeated</th>
                    <th scope="col">Perfect Words</th>
                    <th scope="col">Avg Reaction</th>
                    <th scope="col">DPS</th>
                    <th scope="col">Turret DPS</th>
                    <th scope="col">Typing DPS</th>
                    <th scope="col">Turret dmg</th>
                    <th scope="col">Typing dmg</th>
                    <th scope="col">Shield Breaks</th>
                    <th scope="col">Repairs</th>
                    <th scope="col">HP Restored</th>
                    <th scope="col">Repair Gold</th>
                    <th scope="col">Gold</th>
                    <th scope="col">Bonus</th>
                    <th scope="col">Castle Bonus</th>
                    <th scope="col">Duration</th>
                  </tr>
                </thead>
                <tbody id="debug-analytics-viewer-body">
                  <tr class="analytics-empty-row">
                    <td colspan="20">
                      No wave summaries yet - finish a wave to populate analytics.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </details>
        </section>
      </aside>
    </div>
    <div id="diagnostics-overlay" data-visible="false"></div>
    <div
      id="main-menu-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="main-menu-title"
    >
      <div class="main-menu-card">
        <h1 id="main-menu-title">Keyboard Defense</h1>
        <p id="main-menu-copy">Prepare for the Siege of the Azure Vale.</p>
        <div class="main-menu-options" id="main-menu-options">
          <label class="option-toggle main-menu-telemetry" id="main-menu-telemetry-toggle-wrapper">
            <input id="main-menu-telemetry-toggle" type="checkbox" />
            <span class="option-toggle-label">Send telemetry to help improve the siege.</span>
            <span class="option-toggle-help">
              Telemetry stays local unless you export it. Toggle anytime from the pause menu.
            </span>
          </label>
          <label class="option-toggle" id="main-menu-crystal-toggle-wrapper">
            <input id="main-menu-crystal-toggle" type="checkbox" />
            <span class="option-toggle-label">Enable Crystal Pulse turret (experimental)</span>
            <span class="option-toggle-help">
              Unlocks shield-burst pulses that shred enemy barriers when you need them.
            </span>
          </label>
          <label class="option-toggle" id="main-menu-elite-toggle-wrapper">
            <input id="main-menu-elite-toggle" type="checkbox" />
            <span class="option-toggle-label">Enable Elite Affixes</span>
            <span class="option-toggle-help">
              Allow armored, shielded, or aura elites to appear for greater rewards.
            </span>
          </label>
        </div>
        <div class="main-menu-actions">
          <button id="main-menu-start-tutorial">Begin Tutorial</button>
          <button id="main-menu-skip-tutorial">Skip Tutorial</button>
          <button id="main-menu-practice-mode">Practice Mode</button>
          <button id="main-menu-typing-drills">Typing Drills</button>
          <p id="main-menu-typing-drill-reco" class="main-menu-typing-drill-reco" data-visible="false">
            Recommended: <span class="main-menu-typing-drill-reco-mode"></span>
          </p>
          <button id="main-menu-typing-drill-run" type="button" class="secondary">
            Run Recommended Drill
          </button>
          <button id="main-menu-replay-tutorial">Replay Tutorial</button>
        </div>
      </div>
    </div>
    <div
      id="tutorial-summary"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="tutorial-summary-title"
    >
      <div class="tutorial-summary-card">
        <h2 id="tutorial-summary-title">Training Complete</h2>
        <p id="tutorial-summary-copy">Great work defending the gate. Here's how you did:</p>
        <ul id="tutorial-summary-stats">
          <li data-field="accuracy"></li>
          <li data-field="combo"></li>
          <li data-field="breaches"></li>
          <li data-field="shield-breaks"></li>
          \n
          <li data-field="gold"></li>
        </ul>
        <div class="tutorial-summary-actions">
          <button id="tutorial-summary-continue">Proceed to Campaign</button>
          <button id="tutorial-summary-replay">Replay Tutorial</button>
        </div>
      </div>
    </div>
    <div
      id="wave-scorecard"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="wave-scorecard-title"
        >
          <div class="wave-scorecard-card">
            <header class="wave-scorecard-header">
              <h2 id="wave-scorecard-title">Wave Complete</h2>
              <p id="wave-scorecard-subtitle">
                Breathe easy-your defenses held. Here's the after-action report.
              </p>
            </header>
            <ul id="wave-scorecard-stats">
              <li data-field="wave"></li>
          <li data-field="accuracy"></li>
          <li data-field="combo"></li>
          <li data-field="session-combo"></li>
          <li data-field="defeated"></li>
          <li data-field="breaches"></li>
          <li data-field="perfect-words"></li>
          <li data-field="reaction"></li>
          <li data-field="dps"></li>
          <li data-field="dps-turret"></li>
          <li data-field="dps-typing"></li>
          <li data-field="damage-turret"></li>
          <li data-field="damage-typing"></li>
          <li data-field="shield-breaks"></li>
          <li data-field="repairs"></li>
          <li data-field="repair-health"></li>
          <li data-field="repair-gold"></li>
          <li data-field="bonus-gold"></li>
              <li data-field="castle-bonus"></li>
              <li data-field="gold"></li>
            </ul>
            <p
              id="wave-scorecard-tip"
              class="wave-scorecard-tip"
              data-visible="false"
              role="status"
              aria-live="polite"
              aria-hidden="true"
            ></p>
            <div class="wave-scorecard-actions">
              <button id="wave-scorecard-continue" type="button" class="primary">
                Ready the Next Wave
              </button>
            </div>
      </div>
    </div>
    <div
      id="enemy-intro-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="enemy-intro-title"
      aria-hidden="true"
    >
      <div class="enemy-intro-card">
        <header class="enemy-intro-header">
          <div class="enemy-intro-kicker">First encounter</div>
          <h3 id="enemy-intro-title">New enemy</h3>
          <p id="enemy-intro-role" class="enemy-intro-role"></p>
          <button
            id="enemy-intro-close"
            class="icon-button"
            type="button"
            aria-label="Close enemy intro"
          ></button>
        </header>
        <p id="enemy-intro-description" class="enemy-intro-description"></p>
        <ul id="enemy-intro-tips" class="enemy-intro-tips"></ul>
        <div class="enemy-intro-actions">
          <button id="enemy-intro-dismiss" type="button" class="primary-button">
            Got it
          </button>
        </div>
      </div>
    </div>
    <div
      id="accessibility-onboarding"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="accessibility-onboarding-title"
      aria-describedby="accessibility-onboarding-desc"
      aria-hidden="true"
    >
      <div class="accessibility-card">
        <header class="accessibility-header">
          <div>
            <p class="accessibility-kicker">Comfort setup</p>
            <h3 id="accessibility-onboarding-title">Pick your comfort defaults</h3>
            <p id="accessibility-onboarding-desc" class="accessibility-desc">
              We can reduce effects and adjust text to keep runs comfortable.
            </p>
          </div>
          <button
            id="accessibility-onboarding-close"
            class="icon-button"
            type="button"
            aria-label="Close accessibility setup"
          ></button>
        </header>
        <div class="accessibility-options">
          <label class="option-toggle">
            <input id="accessibility-reduced-motion" type="checkbox" />
            <span class="option-toggle-label">Reduced Motion</span>
            <span class="option-toggle-help">
              Disable heavy death effects and UI transitions.
            </span>
          </label>
          <label class="option-toggle">
            <input id="accessibility-dyslexia-spacing" type="checkbox" />
            <span class="option-toggle-label">Dyslexia Spacing</span>
            <span class="option-toggle-help">
              Adds letter spacing/line height to words and prompts.
            </span>
          </label>
          <label class="option-toggle">
            <input id="accessibility-colorblind" type="checkbox" />
            <span class="option-toggle-label">Colorblind Palette</span>
            <span class="option-toggle-help">
              Swaps UI accents for higher separation.
            </span>
          </label>
          <label class="option-toggle option-range">
            <span class="option-toggle-label">Background Brightness</span>
            <input
              id="accessibility-bg-brightness"
              type="range"
              min="0.9"
              max="1.1"
              step="0.01"
              value="1"
              aria-label="Background brightness"
            />
            <span class="option-range-value" id="accessibility-bg-brightness-value">100%</span>
          </label>
        </div>
        <div class="accessibility-actions">
          <button id="accessibility-skip" type="button" class="ghost-button">Skip</button>
          <button id="accessibility-apply" type="button" class="primary-button">
            Apply &amp; play
          </button>
        </div>
      </div>
    </div>
    <div
      id="roadmap-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="roadmap-overlay-title"
    >
      <div class="roadmap-card">
        <header class="roadmap-header">
          <div class="roadmap-title-block">
            <p class="roadmap-kicker">Siege of the Azure Vale</p>
            <h2 id="roadmap-overlay-title">Season Roadmap</h2>
          </div>
          <button
            id="roadmap-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close season roadmap"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <p class="roadmap-subtitle">
          Track the story beats, systems, and codex drops as you push through the siege.
        </p>
        <div class="roadmap-summary">
          <div class="roadmap-pill" aria-live="polite">
            <span class="roadmap-pill-label">Wave</span>
            <span id="roadmap-summary-wave" class="roadmap-pill-value">Wave 1 / 3</span>
          </div>
          <div class="roadmap-pill" aria-live="polite">
            <span class="roadmap-pill-label">Castle</span>
            <span id="roadmap-summary-castle" class="roadmap-pill-value">Lv. 1</span>
          </div>
          <div class="roadmap-pill" aria-live="polite">
            <span class="roadmap-pill-label">Codex</span>
            <span id="roadmap-summary-lore" class="roadmap-pill-value">0 entries</span>
          </div>
        </div>
        <div class="roadmap-filters" role="group" aria-label="Filter roadmap steps">
          <label><input id="roadmap-filter-story" type="checkbox" checked />Story</label>
          <label><input id="roadmap-filter-systems" type="checkbox" checked />Systems</label>
          <label><input id="roadmap-filter-challenge" type="checkbox" checked />Challenges</label>
          <label><input id="roadmap-filter-lore" type="checkbox" checked />Lore</label>
          <label><input id="roadmap-filter-completed" type="checkbox" />Show completed</label>
        </div>
        <div id="roadmap-tracked" class="roadmap-tracked" data-visible="false">
          <div class="roadmap-tracked-text">
            <p class="roadmap-tracked-label">Tracking</p>
            <p id="roadmap-tracked-title" class="roadmap-tracked-title"></p>
            <p id="roadmap-tracked-progress" class="roadmap-tracked-progress"></p>
          </div>
          <div class="roadmap-tracked-actions">
            <button id="roadmap-tracked-clear" type="button" class="ghost-button">
              Clear
            </button>
          </div>
        </div>
        <ul id="roadmap-list" class="roadmap-list" aria-live="polite"></ul>
      </div>
    </div>
    <div
      id="shortcut-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="shortcut-overlay-title"
    >
      <div class="shortcut-overlay-card">
        <header class="shortcut-overlay-header">
          <h2 id="shortcut-overlay-title">Keyboard Shortcuts</h2>
          <button
            id="shortcut-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close shortcut reference"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <p class="shortcut-overlay-subtitle">Stay on top of the siege with quick commands.</p>
        <ul class="shortcut-list">
          <li>
            <span class="shortcut-key">?</span
            ><span class="shortcut-desc">Toggle this overlay</span>
          </li>
          <li>
            <span class="shortcut-key">D</span
            ><span class="shortcut-desc">Toggle diagnostics overlay</span>
          </li>
          <li>
            <span class="shortcut-key">M</span
            ><span class="shortcut-desc">Mute or enable battle audio</span>
          </li>
          <li>
            <span class="shortcut-key">P</span
            ><span class="shortcut-desc">Pause or resume the battle</span>
          </li>
          <li>
            <span class="shortcut-key">Shift + R</span
            ><span class="shortcut-desc">Open typing drills and auto-run the recommended mode</span>
          </li>
          <li>
            <span class="shortcut-key">Ctrl/Cmd&nbsp;+&nbsp;?</span
            ><span class="shortcut-desc">Clear typing buffer (lose 1 combo)</span>
          </li>
          <li>
            <span class="shortcut-key">Esc</span
            ><span class="shortcut-desc">Dismiss overlays and return focus to typing</span>
          </li>
        </ul>
      </div>
    </div>
    <div
      id="options-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="options-overlay-title"
    >
      <div class="options-overlay-card">
        <header class="options-overlay-header">
          <h2 id="options-overlay-title">Battle Paused</h2>
          <button
            id="options-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close pause menu"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <p class="options-overlay-subtitle">
          Adjust your defenses, then charge back into the fray.
        </p>
        <div
          id="options-castle-bonus"
          class="options-info"
          role="status"
          aria-live="polite"
          aria-atomic="true"
        ></div>
        <ul id="options-castle-benefits" class="options-benefits" aria-live="polite"></ul>
        <div
          id="options-passives-section"
          class="options-passives-wrapper"
          data-collapsed="false"
        >
          <div class="options-passives-header">
            <p class="options-passives-heading">Active Passives</p>
            <span id="options-passives-summary" class="options-passives-summary"></span>
            <button
              id="options-passives-toggle"
              class="options-passives-toggle"
              type="button"
              aria-controls="options-castle-passives"
              aria-expanded="true"
            >
              Hide Active Passives
            </button>
          </div>
          <div class="options-passives-body">
            <ul id="options-castle-passives" class="options-passives" aria-live="polite"></ul>
          </div>
        </div>
        <div class="options-toggle-group">
          <label class="option-toggle">
            <input id="options-sound-toggle" type="checkbox" />
            <span class="option-toggle-label">Sound Effects</span>
          </label>
          <label class="option-toggle option-range">
            <span class="option-toggle-label">Sound Volume</span>
            <input
              id="options-sound-volume"
              type="range"
              min="0"
              max="1"
              step="0.05"
              value="0.8"
              aria-label="Sound volume"
            />
            <span class="option-range-value" id="options-sound-volume-value">80%</span>
          </label>
          <label class="option-toggle option-range">
            <span class="option-toggle-label">Audio Intensity</span>
            <input
              id="options-sound-intensity"
              type="range"
              min="0.5"
              max="1.5"
              step="0.05"
              value="1"
              aria-label="Audio intensity"
            />
            <span class="option-range-value" id="options-sound-intensity-value">100%</span>
          </label>
          <label class="option-toggle">
            <input id="options-diagnostics-toggle" type="checkbox" />
            <span class="option-toggle-label">Diagnostics Overlay</span>
          </label>
          <label class="option-toggle">
            <input id="options-low-graphics-toggle" type="checkbox" />
            <span class="option-toggle-label">Low Graphics Mode</span>
            <span class="option-toggle-help">
              Turns off starfield and heavy effects for slower devices (auto-enables reduced
              motion).
            </span>
          </label>
            <label class="option-toggle">
              <input id="options-reduced-motion-toggle" type="checkbox" />
              <span class="option-toggle-label">Reduced Motion</span>
              <span class="option-toggle-help">
                Disables enemy death splashes and UI transitions; keeps essential cues only.
              </span>
            </label>
          <label class="option-toggle">
            <input id="options-haptics-toggle" type="checkbox" />
            <span class="option-toggle-label">Haptics (vibration)</span>
            <span class="option-toggle-help">
              Short vibrations on hits when supported; desktop browsers usually ignore this.
            </span>
          </label>
          <label class="option-toggle option-select">
            <span class="option-toggle-label">Text Size</span>
            <select id="options-text-size" aria-label="Text size preference">
              <option value="0.9">Small</option>
              <option value="1">Medium</option>
              <option value="1.1">Large</option>
            </select>
            <span class="option-toggle-help">Scales HUD and menu text without changing layout.</span>
          </label>
          <label class="option-toggle">
            <input id="options-checkered-bg-toggle" type="checkbox" />
            <span class="option-toggle-label">Checkered Background</span>
          </label>
          <label class="option-toggle">
            <input id="options-readable-font-toggle" type="checkbox" />
            <span class="option-toggle-label">Readable Font</span>
          </label>
          <label class="option-toggle">
            <input id="options-dyslexia-font-toggle" type="checkbox" />
            <span class="option-toggle-label">Dyslexia-Friendly Font</span>
          </label>
          <label class="option-toggle">
            <input id="options-dyslexia-spacing-toggle" type="checkbox" />
            <span class="option-toggle-label">Increase Letter Spacing</span>
            <span class="option-toggle-help">
              Adds extra spacing and line height for clearer shapes while typing.
            </span>
          </label>
          <label class="option-toggle">
            <input id="options-colorblind-toggle" type="checkbox" />
            <span class="option-toggle-label">Colorblind Palette</span>
          </label>
          <label class="option-toggle option-select">
            <span class="option-toggle-label">Colorblind Palette Mode</span>
            <select id="options-colorblind-mode" aria-label="Colorblind palette mode">
              <option value="off">Off</option>
              <option value="deuteran">Deuteran (green weakness)</option>
              <option value="protan">Protan (red weakness)</option>
              <option value="tritan">Tritan (blue weakness)</option>
              <option value="high-contrast">High contrast</option>
            </select>
            <span class="option-toggle-help">
              Pick the palette that separates reds/greens/blues best for you. Enabling a mode turns on the palette.
            </span>
          </label>
          <label class="option-toggle option-range">
            <span class="option-toggle-label">Background Brightness</span>
            <input
              id="options-bg-brightness"
              type="range"
              min="0.9"
              max="1.1"
              step="0.02"
              value="1"
              aria-label="Background brightness"
            />
            <span class="option-range-value" id="options-bg-brightness-value">100%</span>
            <span class="option-toggle-help">
              Lighten or darken UI backgrounds for comfort; unaffected by low-graphics.
            </span>
          </label>
          <label class="option-toggle option-select">
            <span class="option-toggle-label">Defeat Animations</span>
            <select id="options-defeat-animation" aria-label="Defeat animation mode">
              <option value="auto">Auto (sprites when available)</option>
              <option value="sprite">Sprites only</option>
              <option value="procedural">Procedural only</option>
            </select>
            <span class="option-toggle-help">
              Choose how enemy defeat bursts render when art assets are available.
            </span>
          </label>
          <label class="option-toggle" id="options-elite-affix-toggle-wrapper">
            <input id="options-elite-affix-toggle" type="checkbox" />
            <span class="option-toggle-label">Enable Elite Affixes</span>
            <span class="option-toggle-help">
              Armored, shielded, or aura elites join waves when enabled; toggle off for calmer runs.
            </span>
          </label>
          <label class="option-toggle" id="options-crystal-toggle-wrapper">
            <input id="options-crystal-toggle" type="checkbox" />
            <span class="option-toggle-label">Enable Crystal Pulse turret</span>
            <span class="option-toggle-help">
              Experimental turret that delivers bonus shield damage for barrier-heavy waves.
            </span>
          </label>
          <label class="option-toggle" id="options-telemetry-toggle-wrapper">
            <input id="options-telemetry-toggle" type="checkbox" />
            <span class="option-toggle-label">Send Telemetry</span>
          </label>
          <label class="option-toggle option-select">
            <span class="option-toggle-label">HUD Font Size</span>
            <select id="options-font-scale">
              <option value="0.85">Small</option>
              <option value="1">Default</option>
              <option value="1.15">Large</option>
              <option value="1.3">Extra Large</option>
            </select>
            <span class="option-toggle-help">Tip: While this menu is open press [ / ] to change HUD font size.</span>
          </label>
          <label class="option-toggle option-select">
            <span class="option-toggle-label">Pause Shortcut</span>
            <select id="options-hotkey-pause" aria-label="Pause shortcut key">
              <option value="p">P (default)</option>
              <option value="escape">Escape</option>
              <option value="space">Spacebar</option>
              <option value="o">O</option>
            </select>
            <span class="option-toggle-help">
              Choose which key pauses/resumes. Works even while typing input is focused.
            </span>
          </label>
          <label class="option-toggle option-select">
            <span class="option-toggle-label">Shortcuts Overlay</span>
            <select id="options-hotkey-shortcuts" aria-label="Shortcuts overlay key">
              <option value="?">?</option>
              <option value="slash">/</option>
              <option value="f1">F1</option>
            </select>
            <span class="option-toggle-help">
              Pick a key to toggle the keyboard shortcuts overlay for accessibility.
            </span>
          </label>
          <label class="option-toggle">
            <input id="options-toggle-metrics" type="checkbox" />
            <span class="option-toggle-label">Show Typing Metrics</span>
            <span class="option-toggle-help">
              Hides or shows the Accuracy/WPM panel if you prefer fewer HUD elements.
            </span>
          </label>
          <label class="option-toggle">
            <input id="options-toggle-wave-preview" type="checkbox" />
            <span class="option-toggle-label">Show Upcoming Enemies</span>
            <span class="option-toggle-help">
              Toggle the wave preview list; turn off for a cleaner combat view.
            </span>
          </label>
          <label class="option-toggle">
            <input id="options-toggle-battle-log" type="checkbox" />
            <span class="option-toggle-label">Show Battle Log</span>
            <span class="option-toggle-help">
              Turn off the running battle log if you only want on-screen cues.
            </span>
          </label>
        </div>
        <div class="options-actions">
          <button id="options-parental-info" type="button" class="secondary">
            Parental Info
          </button>
          <button id="options-analytics-export" type="button" class="secondary">
            Download Analytics
          </button>
          <button id="options-typing-drills" type="button" class="secondary">
            Open Typing Drills
          </button>
          <p class="options-hint">Tip: Press Shift + R to launch the recommended drill instantly.</p>
          <button id="options-resume-button" type="button" class="primary">Resume Battle</button>
        </div>
      </div>
    </div>
    <div
      id="parental-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="parental-overlay-title"
      aria-describedby="parental-overlay-desc"
      aria-hidden="true"
    >
      <div class="info-overlay-card">
        <header class="info-overlay-header">
          <div>
            <p class="info-overlay-kicker">For parents & guardians</p>
            <h2 id="parental-overlay-title">Privacy & Safety Notes</h2>
            <p id="parental-overlay-desc" class="info-overlay-subtitle">
              Keyboard Defense is local-first: no accounts, no online tracking, and everything is
              built for ages 8-16 on Edge/Chrome.
            </p>
          </div>
          <button
            id="parental-overlay-close"
            class="icon-button"
            type="button"
            aria-label="Close parental info"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </header>
        <ul class="info-overlay-list">
          <li>All progress/settings stay in local storage; nothing is sent online.</li>
          <li>Telemetry is opt-in only and off by default; exports are manual.</li>
          <li>No accounts, chat, ads, or payment flows are present.</li>
          <li>Word lists and UI copy follow kid-safe language guidelines.</li>
          <li>You can clear data anytime via browser storage or by resetting progress.</li>
        </ul>
        <p class="info-overlay-footer">
          Questions about data? Check the pause menu toggles (Telemetry/Analytics) or export locally
          for your own review.
        </p>
      </div>
    </div>
    <div
      id="typing-drills-overlay"
      data-visible="false"
      role="dialog"
      aria-modal="true"
      aria-labelledby="typing-drills-title"
    >
      <div class="typing-drills-card">
        <div class="typing-drills-header">
          <div>
            <p class="typing-drills-kicker">Training Grounds</p>
            <h2 id="typing-drills-title">Typing Drills</h2>
            <p class="typing-drills-subtitle">
              Build muscle memory without risking the gate. Pick a drill, then type until you clear
              the stack or the timer runs out.
            </p>
            <p
              id="typing-drill-fallback"
              class="typing-drill-fallback"
              data-visible="false"
              role="status"
              aria-live="polite"
            >
              <span class="typing-drill-fallback__pill">No recommendation</span>
              <span class="typing-drill-fallback__text">You're in the groove - pick any drill.</span>
            </p>
            <div id="typing-drill-toast" class="typing-drill-toast" role="status" aria-live="polite"></div>
            <div id="typing-drill-recommendation" class="typing-drill-recommendation" data-visible="false">
              <span id="typing-drill-recommendation-badge" class="typing-drill-recommendation__badge"></span>
              <span id="typing-drill-recommendation-reason" class="typing-drill-recommendation__reason"></span>
              <button
                id="typing-drill-recommendation-run"
                type="button"
                class="typing-drill-recommendation__run"
              >
                Run it
              </button>
            </div>
            <p class="typing-drills-shortcut">Keyboard: Shift + R to open and auto-run the recommended drill.</p>
          </div>
          <button
            id="typing-drills-close"
            class="icon-button typing-drills-close"
            type="button"
            aria-label="Close typing drills"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="typing-drills-body">
          <div class="typing-drills-art" aria-hidden="true">
            <div class="typing-drills-orb"></div>
            <div class="typing-drills-arc typing-drills-arc--outer"></div>
            <div class="typing-drills-arc typing-drills-arc--inner"></div>
            <div class="typing-drills-keys">
              <span>Q</span>
              <span>J</span>
              <span>K</span>
              <span>F</span>
              <span>P</span>
            </div>
            <div class="typing-drills-sparks">
              <span></span>
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
          <div class="typing-drills-panel">
            <div class="typing-drills-modes" role="tablist" aria-label="Typing drill modes">
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="burst"
                aria-selected="true"
                role="tab"
              >
                <span class="mode-label">Burst Warmup</span>
                <span class="mode-meta">5 quick words</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="endurance"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Endurance</span>
                <span class="mode-meta">30s cadence</span>
              </button>
              <button
                type="button"
                class="typing-drill-mode"
                data-mode="precision"
                aria-selected="false"
                role="tab"
              >
                <span class="mode-label">Shield Breaker</span>
                <span class="mode-meta">Hard-focus strings</span>
              </button>
            </div>
            <div class="typing-drill-stage">
              <div class="typing-drill-status">
                <span class="typing-drill-status-label" id="typing-drill-status-label">Ready</span>
                <span class="typing-drill-progress" id="typing-drill-progress"></span>
                <span class="typing-drill-timer" id="typing-drill-timer">00:00</span>
              </div>
              <div class="typing-drill-target" id="typing-drill-target"></div>
              <div class="typing-drill-input-row">
                <input
                  id="typing-drill-input"
                  type="text"
                  inputmode="text"
                  autocomplete="off"
                  autocapitalize="none"
                  spellcheck="false"
                  placeholder="Type to strike..."
                />
                <button id="typing-drill-start" class="primary" type="button">Start Drill</button>
                <button id="typing-drill-reset" class="ghost" type="button">Reset</button>
              </div>
              <p class="typing-drill-focus-hint" aria-hidden="true">
                Tip: Tap the field above to focus and raise your keyboard on mobile.
              </p>
              <div class="typing-drill-metrics">
                <div>
                  <span class="metric-label">Accuracy</span>
                  <span class="metric-value" id="typing-drill-accuracy">100%</span>
                </div>
                <div>
                  <span class="metric-label">Combo</span>
                  <span class="metric-value" id="typing-drill-combo">x0</span>
                </div>
                <div>
                  <span class="metric-label">WPM</span>
                  <span class="metric-value" id="typing-drill-wpm">0</span>
                </div>
                <div>
                  <span class="metric-label">Words</span>
                  <span class="metric-value" id="typing-drill-words">0</span>
                </div>
              </div>
              <div class="typing-drill-summary" id="typing-drill-summary" data-visible="false">
                <p class="summary-title">Drill Summary</p>
                <ul>
                  <li>
                    <span>Elapsed</span><span id="typing-drill-summary-time">0s</span>
                  </li>
                  <li>
                    <span>Accuracy</span><span id="typing-drill-summary-accuracy">100%</span>
                  </li>
                  <li>
                    <span>Best Combo</span><span id="typing-drill-summary-combo">x0</span>
                  </li>
                  <li>
                    <span>Words Cleared</span><span id="typing-drill-summary-words">0</span>
                  </li>
                  <li>
                    <span>Errors</span><span id="typing-drill-summary-errors">0</span>
                  </li>
                </ul>
                <p class="summary-tip" id="typing-drill-summary-tip"></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="../dist/src/index.js"></script>
  </body>
</html>
