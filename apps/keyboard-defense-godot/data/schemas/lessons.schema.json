{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "LessonsFile",
  "type": "object",
  "required": ["version", "default_lesson", "lessons"],
  "properties": {
    "version": {"type": "integer", "minimum": 1},
    "default_lesson": {"type": "string", "pattern": "^[a-z0-9_]+$"},
    "graduation_paths": {
      "type": "object",
      "additionalProperties": {"$ref": "#/$defs/graduationPath"}
    },
    "lessons": {
      "type": "array",
      "minItems": 1,
      "items": {"$ref": "#/$defs/lesson"}
    }
  },
  "$defs": {
    "graduationPath": {
      "type": "object",
      "required": ["name", "description", "stages"],
      "properties": {
        "name": {"type": "string"},
        "description": {"type": "string"},
        "stages": {
          "type": "array",
          "items": {"$ref": "#/$defs/graduationStage"}
        }
      },
      "additionalProperties": false
    },
    "graduationStage": {
      "type": "object",
      "required": ["stage", "name", "lessons", "goal"],
      "properties": {
        "stage": {"type": "integer", "minimum": 1},
        "name": {"type": "string"},
        "lessons": {
          "type": "array",
          "items": {"type": "string", "pattern": "^[a-z0-9_]+$"}
        },
        "goal": {"type": "string"}
      },
      "additionalProperties": false
    },
    "lesson": {
      "type": "object",
      "required": ["id", "name", "description", "mode"],
      "properties": {
        "id": {"type": "string", "pattern": "^[a-z0-9_]+$"},
        "name": {"type": "string"},
        "description": {"type": "string"},
        "mode": {"type": "string", "enum": ["charset", "wordlist", "sentence"]},
        "charset": {"type": "string", "minLength": 1},
        "wordlist": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1
        },
        "sentences": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 1,
          "description": "Full sentences for sentence mode"
        },
        "lengths": {"$ref": "#/$defs/lengthRanges"}
      },
      "additionalProperties": false,
      "allOf": [
        {
          "if": {"properties": {"mode": {"const": "charset"}}},
          "then": {"required": ["charset", "lengths"]}
        },
        {
          "if": {"properties": {"mode": {"const": "wordlist"}}},
          "then": {"required": ["wordlist", "lengths"]}
        },
        {
          "if": {"properties": {"mode": {"const": "sentence"}}},
          "then": {"required": ["sentences"]}
        }
      ]
    },
    "lengthRanges": {
      "type": "object",
      "required": ["scout", "raider", "armored"],
      "properties": {
        "scout": {"$ref": "#/$defs/lengthRange"},
        "raider": {"$ref": "#/$defs/lengthRange"},
        "armored": {"$ref": "#/$defs/lengthRange"}
      },
      "additionalProperties": false
    },
    "lengthRange": {
      "type": "array",
      "minItems": 2,
      "maxItems": 2,
      "items": {"type": "integer", "minimum": 1}
    }
  },
  "additionalProperties": false
}
